(function(){CodeMirror.TernServer=function(K){var J=this;this.options=K||{};var I=this.options.plugins||(this.options.plugins={});if(!I.doc_comment){I.doc_comment=true;
}if(this.options.useWorker){this.server=new v(this);}else{this.server=new tern.Server({getFile:function(L,M){return p(J,L,M);},async:true,defs:this.options.defs||[],plugins:I});
}this.docs=Object.create(null);this.trackChange=function(L,M){G(J,L,M);};this.cachedArgHints=null;this.activeArgHints=null;this.jumpStack=[];};CodeMirror.TernServer.prototype={addDoc:function(I,K){var J={doc:K,name:I,changed:null};
this.server.addFile(I,h(this,J));CodeMirror.on(K,"change",this.trackChange);return this.docs[I]=J;},delDoc:function(I){var J=this.docs[I];if(!J){return;
}CodeMirror.off(J.doc,"change",this.trackChange);delete this.docs[I];this.server.delFile(I);},hideDoc:function(I){A(this);var J=this.docs[I];if(J&&J.changed){r(this,J);
}},complete:function(I){var J=this;CodeMirror.showHint(I,function(K,L){return u(J,K,L);},{async:true});},getHint:function(I,J){return u(this,I,J);},showType:function(I){B(this,I);
},updateArgHints:function(I){g(this,I);},jumpToDef:function(I){j(this,I);},jumpBack:function(I){E(this,I);},rename:function(I){k(this,I);},request:function(I,J,K){this.server.request(F(this,m(this,I.getDoc()),J),K);
}};var w=CodeMirror.Pos;var c="CodeMirror-Tern-";var n=250;function p(K,J,L){var I=K.docs[J];if(I){L(h(K,I));}else{if(K.options.getFile){K.options.getFile(J,L);
}else{L(null);}}}function m(K,L,I){for(var N in K.docs){var M=K.docs[N];if(M.doc==L){return M;}}if(!I){for(var J=0;;++J){N="[doc"+(J||"")+"]";if(!K.docs[N]){I=N;
break;}}}return K.addDoc(I,L);}function G(K,M,O){var L=m(K,M);var I=K.cachedArgHints;if(I&&I.doc==M&&x(I.start,O.to)<=0){K.cachedArgHints=null;}var N=L.changed;
if(N==null){L.changed=N={from:O.from.line,to:O.from.line};}var J=O.from.line+(O.text.length-1);if(O.from.line<N.to){N.to=N.to-(O.to.line-J);}if(J>=N.to){N.to=J+1;
}if(N.from>O.from.line){N.from=O.from.line;}if(M.lineCount()>n&&O.to-N.from>100){setTimeout(function(){if(L.changed&&L.changed.to-L.changed.from>100){r(K,L);
}},200);}}function r(I,J){I.server.request({files:[{type:"full",name:J.name,text:h(I,J)}]},function(K){if(K){console.error(K);}else{J.changed=null;}});
}function u(J,I,K){J.request(I,{type:"completions",types:true,docs:true,urls:true},function(R,O){if(R){return e(J,I,R);}var S=[],L="";var T=O.start,U=O.end;
if(I.getRange(w(T.line,T.ch-2),T)=='["'&&I.getRange(U,w(U.line,U.ch+2))!='"]'){L='"]';}for(var P=0;P<O.completions.length;++P){var M=O.completions[P],Q=l(M.type);
if(O.guess){Q+=" "+c+"guess";}S.push({text:M.name+L,displayText:M.name,className:Q,data:M});}var N={from:T,to:U,list:S};var V=null;CodeMirror.on(N,"close",function(){H(V);
});CodeMirror.on(N,"update",function(){H(V);});CodeMirror.on(N,"select",function(Y,X){H(V);var W=J.options.completionTip?J.options.completionTip(Y.data):Y.data.doc;
if(W){V=C(X.parentNode.getBoundingClientRect().right+window.pageXOffset,X.getBoundingClientRect().top+window.pageYOffset,W);V.className+=" "+c+"hint-doc";
}});K(N);});}function l(I){var J;if(I=="?"){J="unknown";}else{if(I=="number"||I=="string"||I=="bool"){J=I;}else{if(/^fn\(/.test(I)){J="fn";}else{if(/^\[/.test(I)){J="array";
}else{J="object";}}}}return c+"completion "+c+"completion-"+J;}function B(J,I){J.request(I,"type",function(K,M){if(K){return e(J,I,K);}if(J.options.typeTip){var L=J.options.typeTip(M);
}else{var L=f("span",null,f("strong",null,M.type||"not found"));if(M.doc){L.appendChild(document.createTextNode(" â€” "+M.doc));}if(M.url){L.appendChild(document.createTextNode(" "));
L.appendChild(f("a",null,"[docs]")).href=M.url;}}y(I,L);});}function g(N,P){A(N);if(P.somethingSelected()){return;}var L=P.getTokenAt(P.getCursor()).state.lexical;
if(L.info!="call"){return;}var J=L.column,O=L.pos||0;for(var R=P.getCursor().line,M=Math.max(0,R-9),Q=false;R>=M;--R){if(P.getLine(R).charAt(J)=="("){Q=true;
break;}}if(!Q){return;}var K=w(R,J);var I=N.cachedArgHints;if(I&&I.doc==P.getDoc()&&x(K,I.start)==0){return a(N,P,O);}N.request(P,{type:"type",preferFunction:true,end:K},function(S,T){if(S||!T.type||!(/^fn\(/).test(T.type)){return;
}N.cachedArgHints={start:O,type:d(T.type),name:T.exprName||T.name||"fn",guess:T.guess,doc:P.getDoc()};a(N,P,O);});}function a(L,P,M){A(L);var I=L.cachedArgHints,N=I.type;
var O=f("span",I.guess?c+"fhint-guess":null,f("span",c+"fname",I.name),"(");for(var K=0;K<N.args.length;++K){if(K){O.appendChild(document.createTextNode(", "));
}var Q=N.args[K];O.appendChild(f("span",c+"farg"+(K==M?" "+c+"farg-current":""),Q.name||"?"));if(Q.type!="?"){O.appendChild(document.createTextNode(":\u00a0"));
O.appendChild(f("span",c+"type",Q.type));}}O.appendChild(document.createTextNode(N.rettype?") ->\u00a0":")"));if(N.rettype){O.appendChild(f("span",c+"type",N.rettype));
}var J=P.cursorCoords(null,"page");L.activeArgHints=C(J.right+1,J.bottom,O);}function d(M){var L=[],N=3;function J(O){var Q=0,R=N;for(;;){var P=M.charAt(N);
if(O.test(P)&&!Q){return M.slice(R,N);}if(/[{\[\(]/.test(P)){++Q;}else{if(/[}\]\)]/.test(P)){--Q;}}++N;}}if(M.charAt(N)!=")"){for(;;){var K=M.slice(N).match(/^([^, \(\[\{]+): /);
if(K){N+=K[0].length;K=K[1];}L.push({name:K,type:J(/[\),]/)});if(M.charAt(N)==")"){break;}N+=2;}}var I=M.slice(N).match(/^\) -> (.*)$/);return{args:L,rettype:I&&I[1]};
}function j(K,I){function J(N){var L={type:"definition",variable:N||null};var M=m(K,I.getDoc());K.server.request(F(K,M,L),function(O,Q){if(O){return e(K,I,O);
}if(!Q.file&&Q.url){window.open(Q.url);return;}if(Q.file){var R=K.docs[Q.file],P;if(R&&(P=z(R.doc,Q))){K.jumpStack.push({file:M.name,start:I.getCursor("from"),end:I.getCursor("to")});
t(K,M,R,P.start,P.end);return;}}e(K,I,"Could not find a definition.");});}if(!s(I)){D(I,"Jump to variable",function(L){if(L){J(L);}});}else{J();}}function E(J,I){var L=J.jumpStack.pop(),K=L&&J.docs[L.file];
if(!K){return;}t(J,m(J,I.getDoc()),K,L.start,L.end);}function t(K,J,L,M,I){L.doc.setSelection(I,M);if(J!=L&&K.options.switchToDoc){A(K);K.options.switchToDoc(L.name);
}}function z(Q,M){var O=M.context.slice(0,M.contextOffset).split("\n");var S=M.start.line-(O.length-1);var J=w(S,(O.length==1?M.start.ch:Q.getLine(S).length)-O[0].length);
var T=Q.getLine(S).slice(J.ch);for(var R=S+1;R<Q.lineCount()&&T.length<M.context.length;++R){T+="\n"+Q.getLine(R);}if(T.slice(0,M.context.length)==M.context){return M;
}var U=Q.getSearchCursor(M.context,0,false);var K,I=Infinity;while(U.findNext()){var P=U.from(),N=Math.abs(P.line-J.line)*10000;if(!N){N=Math.abs(P.ch-J.ch);
}if(N<I){K=P;I=N;}}if(!K){return null;}if(O.length==1){K.ch+=O[0].length;}else{K=w(K.line+(O.length-1),O[O.length-1].length);}if(M.start.line==M.end.line){var L=w(K.line,K.ch+(M.end.ch-M.start.ch));
}else{var L=w(K.line+(M.end.line-M.start.line),M.end.ch);}return{start:K,end:L};}function s(I){var K=I.getCursor("end"),J=I.getTokenAt(K);if(J.start<K.ch&&(J.type=="comment"||J.type=="string")){return false;
}return/\w/.test(I.getLine(K.line).slice(Math.max(K.ch-1,0),K.ch+1));}function k(K,I){var J=I.getTokenAt(I.getCursor());if(!/\w/.test(J.string)){e(K,I,"Not at a variable");
}D(I,"New name for "+J.string,function(L){K.request(I,{type:"rename",newName:L,fullDocs:true},function(M,N){if(M){return e(K,I,M);}o(K,N.changes);});});
}var q=0;function o(N,O){var L=Object.create(null);for(var M=0;M<O.length;++M){var I=O[M];(L[I.file]||(L[I.file]=[])).push(I);}for(var J in L){var Q=N.docs[J],K=L[J];
if(!Q){continue;}K.sort(function(S,R){return x(R,S);});var P="*rename"+(++q);for(var M=0;M<K.length;++M){var I=K[M];Q.doc.replaceRange(I.text,I.start,I.end,P);
}}}function F(N,P,O){var J=[],L=0,I=!O.fullDocs;if(!I){delete O.fullDocs;}if(typeof O=="string"){O={type:O};}O.lineCharPositions=true;if(O.end==null){O.end=P.doc.getCursor("end");
if(P.doc.somethingSelected()){O.start=P.doc.getCursor("start");}}var M=O.start||O.end;if(P.changed){if(P.doc.lineCount()>n&&I!==false&&P.changed.to-P.changed.from<100&&P.changed.from<=M.line&&P.changed.to>O.end.line){J.push(i(P,M,O.end));
O.file="#0";var L=J[0].offsetLines;if(O.start!=null){O.start=w(O.start.line- -L,O.start.ch);}O.end=w(O.end.line-L,O.end.ch);}else{J.push({type:"full",name:P.name,text:h(N,P)});
O.file=P.name;P.changed=null;}}else{O.file=P.name;}for(var K in N.docs){var Q=N.docs[K];if(Q.changed&&Q!=P){J.push({type:"full",name:Q.name,text:h(N,Q)});
Q.changed=null;}}return{query:O,files:J};}function i(Q,J,O){var V=Q.doc;var M=null,K=null,N,R=4;for(var I=J.line-1,P=Math.max(0,I-50);I>=P;--I){var W=V.getLine(I),T=W.search(/\bfunction\b/);
if(T<0){continue;}var L=CodeMirror.countColumn(W,null,R);if(M!=null&&M<=L){continue;}M=L;K=I;}if(K==null){K=P;}var S=Math.min(V.lastLine(),O.line+20);if(M==null||M==CodeMirror.countColumn(V.getLine(J.line),null,R)){N=S;
}else{for(N=O.line+1;N<S;++N){var L=CodeMirror.countColumn(V.getLine(N),null,R);if(L<=M){break;}}}var U=w(K,0);return{type:"part",name:Q.name,offsetLines:U.line,text:V.getRange(U,w(N,0))};
}function x(J,I){return J.line-I.line||J.ch-I.ch;}function f(L,I){var M=document.createElement(L);if(I){M.className=I;}for(var K=2;K<arguments.length;++K){var J=arguments[K];
if(typeof J=="string"){J=document.createTextNode(J);}M.appendChild(J);}return M;}function D(I,K,J){if(I.openDialog){I.openDialog(K+": <input type=text>",J);
}else{J(prompt(K,""));}}function y(J,L){var K=J.cursorCoords();var M=C(K.right+1,K.bottom,L);function I(){if(!M.parentNode){return;}J.off("cursorActivity",I);
b(M);}setTimeout(I,1700);J.on("cursorActivity",I);}function C(I,L,K){var J=f("div",c+"tooltip",K);J.style.left=I+"px";J.style.top=L+"px";document.body.appendChild(J);
return J;}function H(I){var J=I&&I.parentNode;if(J){J.removeChild(I);}}function b(I){I.style.opacity="0";setTimeout(function(){H(I);},1100);}function e(J,I,K){if(J.options.showError){J.options.showError(I,K);
}else{y(I,String(K));}}function A(I){if(I.activeArgHints){H(I.activeArgHints);I.activeArgHints=null;}}function h(I,J){var K=J.doc.getValue();if(I.options.fileFilter){K=I.options.fileFilter(K,J.name,J.doc);
}return K;}function v(I){var M=new Worker(I.options.workerScript);M.postMessage({type:"init",defs:I.options.defs,plugins:I.options.plugins,scripts:I.options.workerDeps});
var K=0,L={};function J(N,O){if(O){N.id=++K;L[K]=O;}M.postMessage(N);}M.onmessage=function(O){var N=O.data;if(N.type=="getFile"){p(I,name,function(P,Q){J({type:"getFile",err:String(P),text:Q,id:N.id});
});}else{if(N.type=="debug"){console.log(N.message);}else{if(N.id&&L[N.id]){L[N.id](N.err,N.body);delete L[N.id];}}}};M.onerror=function(N){for(var O in L){L[O](N);
}L={};};this.addFile=function(N,O){J({type:"add",name:N,text:O});};this.delFile=function(N){J({type:"del",name:N});};this.request=function(N,O){J({type:"req",body:N},O);
};}})();