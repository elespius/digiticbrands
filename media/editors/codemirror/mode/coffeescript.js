/**
 *    coffeescript.js
 **/
CodeMirror.defineMode("coffeescript",function(a){function c(a){return new RegExp("^(("+a.join(")|(")+"))\\b")}function p(a,c){if(a.sol()){null===c.scope.align&&(c.scope.align=!1);var i=c.scope.offset;if(a.eatSpace()){var j=a.indentation();return j>i&&"coffee"==c.scope.type?"indent":i>j?"dedent":null}i>0&&t(a,c)}if(a.eatSpace())return null;var n=a.peek();if(a.match("####"))return a.skipToEnd(),"comment";if(a.match("###"))return c.tokenize=r,c.tokenize(a,c);if("#"===n)return a.skipToEnd(),"comment";if(a.match(/^-?[0-9\.]/,!1)){var p=!1;if(a.match(/^-?\d*\.\d+(e[\+\-]?\d+)?/i)&&(p=!0),a.match(/^-?\d+\.\d*/)&&(p=!0),a.match(/^-?\.\d+/)&&(p=!0),p)return"."==a.peek()&&a.backUp(1),"number";var s=!1;if(a.match(/^-?0x[0-9a-f]+/i)&&(s=!0),a.match(/^-?[1-9]\d*(e[\+\-]?\d+)?/)&&(s=!0),a.match(/^-?0(?![\dx])/i)&&(s=!0),s)return"number"}if(a.match(l))return c.tokenize=q(a.current(),"string"),c.tokenize(a,c);if(a.match(m)){if("/"!=a.current()||a.match(/^.*\//,!1))return c.tokenize=q(a.current(),"string-2"),c.tokenize(a,c);a.backUp(1)}return a.match(d)||a.match(h)?"operator":a.match(e)?"punctuation":a.match(o)?"atom":a.match(k)?"keyword":a.match(f)?"variable":a.match(g)?"property":(a.next(),b)}function q(c,d){var e=1==c.length;return function(f,g){for(;!f.eol();)if(f.eatWhile(/[^'"\/\\]/),f.eat("\\")){if(f.next(),e&&f.eol())return d}else{if(f.match(c))return g.tokenize=p,d;f.eat(/['"\/]/)}return e&&(a.mode.singleLineStringErrors?d=b:g.tokenize=p),d}}function r(a,b){for(;!a.eol();){if(a.eatWhile(/[^#]/),a.match("###")){b.tokenize=p;break}a.eatWhile("#")}return"comment"}function s(b,c,d){d=d||"coffee";for(var e=0,f=!1,g=null,h=c.scope;h;h=h.prev)if("coffee"===h.type){e=h.offset+a.indentUnit;break}"coffee"!==d?(f=null,g=b.column()+b.current().length):c.scope.align&&(c.scope.align=!1),c.scope={offset:e,type:d,prev:c.scope,align:f,alignOffset:g}}function t(a,b){if(b.scope.prev){if("coffee"===b.scope.type){for(var c=a.indentation(),d=!1,e=b.scope;e;e=e.prev)if(c===e.offset){d=!0;break}if(!d)return!0;for(;b.scope.prev&&b.scope.offset!==c;)b.scope=b.scope.prev;return!1}return b.scope=b.scope.prev,!1}}function u(a,c){var d=c.tokenize(a,c),e=a.current();if("."===e)return d=c.tokenize(a,c),e=a.current(),/^\.[\w$]+$/.test(e)?"variable":b;"return"===e&&(c.dedent+=1),("->"!==e&&"=>"!==e||c.lambda||a.peek())&&"indent"!==d||s(a,c);var f="[({".indexOf(e);if(-1!==f&&s(a,c,"])}".slice(f,f+1)),i.exec(e)&&s(a,c),"then"==e&&t(a,c),"dedent"===d&&t(a,c))return b;if(f="])}".indexOf(e),-1!==f){for(;"coffee"==c.scope.type&&c.scope.prev;)c.scope=c.scope.prev;c.scope.type==e&&(c.scope=c.scope.prev)}return c.dedent>0&&a.eol()&&"coffee"==c.scope.type&&(c.scope.prev&&(c.scope=c.scope.prev),c.dedent-=1),d}var b="error",d=/^(?:->|=>|\+[+=]?|-[\-=]?|\*[\*=]?|\/[\/=]?|[=!]=|<[><]?=?|>>?=?|%=?|&=?|\|=?|\^=?|\~|!|\?)/,e=/^(?:[()\[\]{},:`=;]|\.\.?\.?)/,f=/^[_A-Za-z$][_A-Za-z$0-9]*/,g=/^(@|this\.)[_A-Za-z$][_A-Za-z$0-9]*/,h=c(["and","or","not","is","isnt","in","instanceof","typeof"]),i=["for","while","loop","if","unless","else","switch","try","catch","finally","class"],j=["break","by","continue","debugger","delete","do","in","of","new","return","then","this","throw","when","until"],k=c(i.concat(j));i=c(i);var l=/^('{3}|\"{3}|['\"])/,m=/^(\/{3}|\/)/,n=["Infinity","NaN","undefined","null","true","false","on","off","yes","no"],o=c(n),v={startState:function(a){return{tokenize:p,scope:{offset:a||0,type:"coffee",prev:null,align:!1},lastToken:null,lambda:!1,dedent:0}},token:function(a,b){var c=null===b.scope.align&&b.scope;c&&a.sol()&&(c.align=!1);var d=u(a,b);return c&&d&&"comment"!=d&&(c.align=!0),b.lastToken={style:d,content:a.current()},a.eol()&&a.lambda&&(b.lambda=!1),d},indent:function(a,b){if(a.tokenize!=p)return 0;var c=a.scope,d=b&&"])}".indexOf(b.charAt(0))>-1;if(d)for(;"coffee"==c.type&&c.prev;)c=c.prev;var e=d&&c.type===b.charAt(0);return c.align?c.alignOffset-(e?1:0):(e?c.prev:c).offset},lineComment:"#",fold:"indent"};return v}),CodeMirror.defineMIME("text/x-coffeescript","coffeescript");