!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){var t=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),n=e.Pos,r={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function i(e,t,i){var a=e.getLineHandle(t.line),c=t.ch-1,l=i&&i.afterCursor;null==l&&(l=/(^| )cm-fat-cursor($| )/.test(e.getWrapperElement().className));var f=!l&&c>=0&&r[a.text.charAt(c)]||r[a.text.charAt(++c)];if(!f)return null;var s=">"==f.charAt(1)?1:-1;if(i&&i.strict&&s>0!=(c==t.ch))return null;var u=e.getTokenTypeAt(n(t.line,c+1)),h=o(e,n(t.line,c+(s>0?1:0)),s,u||null,i);return null==h?null:{from:n(t.line,c),to:h&&h.pos,match:h&&h.ch==f.charAt(0),forward:s>0}}function o(e,t,i,o,a){for(var c=a&&a.maxScanLineLength||1e4,l=a&&a.maxScanLines||1e3,f=[],s=a&&a.bracketRegex?a.bracketRegex:/[(){}[\]]/,u=i>0?Math.min(t.line+l,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-l),h=t.line;h!=u;h+=i){var m=e.getLine(h);if(m){var d=i>0?0:m.length-1,g=i>0?m.length:-1;if(!(m.length>c))for(h==t.line&&(d=t.ch-(i<0?1:0));d!=g;d+=i){var p=m.charAt(d);if(s.test(p)&&(void 0===o||e.getTokenTypeAt(n(h,d+1))==o)){if(">"==r[p].charAt(1)==i>0)f.push(p);else{if(!f.length)return{pos:n(h,d),ch:p};f.pop()}}}}}return h-i!=(i>0?e.lastLine():e.firstLine())&&null}function a(e,r,o){for(var a=e.state.matchBrackets.maxHighlightLineLength||1e3,c=[],l=e.listSelections(),f=0;f<l.length;f++){var s=l[f].empty()&&i(e,l[f].head,o);if(s&&e.getLine(s.from.line).length<=a){var u=s.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";c.push(e.markText(s.from,n(s.from.line,s.from.ch+1),{className:u})),s.to&&e.getLine(s.to.line).length<=a&&c.push(e.markText(s.to,n(s.to.line,s.to.ch+1),{className:u}))}}if(c.length){t&&e.state.focused&&e.focus();var h=function(){e.operation(function(){for(var e=0;e<c.length;e++)c[e].clear()})};if(!r)return h;setTimeout(h,800)}}var c=null;function l(e){e.operation(function(){c&&(c(),c=null),c=a(e,!1,e.state.matchBrackets)})}e.defineOption("matchBrackets",!1,function(t,n,r){r&&r!=e.Init&&(t.off("cursorActivity",l),c&&(c(),c=null)),n&&(t.state.matchBrackets="object"==typeof n?n:{},t.on("cursorActivity",l))}),e.defineExtension("matchBrackets",function(){a(this,!0)}),e.defineExtension("findMatchingBracket",function(e,t,n){return(n||"boolean"==typeof t)&&(n?(n.strict=t,t=n):t=t?{strict:!0}:null),i(this,e,t)}),e.defineExtension("scanForBracket",function(e,t,n,r){return o(this,e,t,n,r)})});