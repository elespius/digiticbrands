!function(){var t,e,n={},o=function(t,e,o){if("string"!=typeof t)throw"module id must be a string";if(void 0===e)throw"no dependencies for "+t;if(void 0===o)throw"no definition function for "+t;n[t]={deps:e,defn:o,instance:void 0}},i=function(t){var e=n[t];if(void 0===e)throw"module ["+t+"] was undefined";return void 0===e.instance&&function(t){for(var e=n[t],o=e.deps,c=e.defn,r=o.length,l=new Array(r),u=0;u<r;++u)l[u]=i(o[u]);var a=c.apply(null,l);if(void 0===a)throw"module ["+t+"] returned undefined";e.instance=a}(t),e.instance},c=o;t="global!tinymce.util.Tools.resolve",e=tinymce.util.Tools.resolve,c(t,[],function(){return e}),c("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.PluginManager")}),c("tinymce.core.dom.DOMUtils",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.dom.DOMUtils")}),c("tinymce.core.util.I18n",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.I18n")}),c("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.Tools")}),c("tinymce.plugins.toc.api.Settings",[],function(){return{getTocClass:function(t){return t.getParam("toc_class","mce-toc")},getTocHeader:function(t){var e=t.getParam("toc_header","h2");return/^h[1-6]$/.test(e)?e:"h2"},getTocDepth:function(t){var e=parseInt(t.getParam("toc_depth","3"),10);return e>=1&&e<=9?e:3}}}),c("tinymce.plugins.toc.core.Guid",[],function(){return{create:function(t){var e=0;return function(){var n=(new Date).getTime().toString(32);return t+n+(e++).toString(32)}}}}),c("tinymce.plugins.toc.core.Toc",["tinymce.core.dom.DOMUtils","tinymce.core.util.I18n","tinymce.core.util.Tools","tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.Guid"],function(t,e,n,o,i){var c=i.create("mcetoc_"),r=function(t){var e=o.getTocClass(t),i=o.getTocHeader(t),r=function(t){var e,n=[];for(e=1;e<=t;e++)n.push("h"+e);return n.join(",")}(o.getTocDepth(t)),l=t.$(r);return l.length&&/^h[1-9]$/i.test(i)&&(l=l.filter(function(n,o){return!t.dom.hasClass(o.parentNode,e)})),n.map(l,function(e){return{id:e.id?e.id:c(),level:parseInt(e.nodeName.replace(/^H/i,""),10),title:t.$.text(e),element:e}})},l=function(n){var i,c,l,u,a,s,d,f="",m=r(n),g=function(t){var e,n=9;for(e=0;e<t.length;e++)if(t[e].level<n&&(n=t[e].level),1===n)return n;return n}(m)-1;if(!m.length)return"";for(f+=(a=o.getTocHeader(n),s=e.translate("Table of Contents"),d="</"+a+">","<"+a+' contenteditable="true">'+t.DOM.encode(s)+d),i=0;i<m.length;i++){if((l=m[i]).element.id=l.id,u=m[i+1]&&m[i+1].level,g===l.level)f+="<li>";else for(c=g;c<l.level;c++)f+="<ul><li>";if(f+='<a href="#'+l.id+'">'+l.title+"</a>",u!==l.level&&u)for(c=l.level;c>u;c--)f+="</li></ul><li>";else f+="</li>",u||(f+="</ul>");g=l.level}return f},u=function(t){var e=o.getTocClass(t),n=t.$("."+e);n.length&&t.undoManager.transact(function(){n.html(l(t))})};return{hasHeaders:function(t){return r(t).length>0},insertToc:function(t){var e=o.getTocClass(t);!function(t,e){return!e.length||t.dom.getParents(e[0],".mce-offscreen-selection").length>0}(t,t.$("."+e))?u(t):t.insertContent(function(t){var e=l(t);return'<div class="'+t.dom.encode(o.getTocClass(t))+'" contenteditable="false">'+e+"</div>"}(t))},updateToc:u}}),c("tinymce.plugins.toc.api.Commands",["tinymce.plugins.toc.core.Toc"],function(t){return{register:function(e){e.addCommand("mceInsertToc",function(){t.insertToc(e)}),e.addCommand("mceUpdateToc",function(){t.updateToc(e)})}}}),c("tinymce.plugins.toc.core.FilterContent",["tinymce.plugins.toc.api.Settings"],function(t){return{setup:function(e){var n=e.$,o=t.getTocClass(e);e.on("PreProcess",function(t){var e=n("."+o,t.node);e.length&&(e.removeAttr("contentEditable"),e.find("[contenteditable]").removeAttr("contentEditable"))}),e.on("SetContent",function(){var t=n("."+o);t.length&&(t.attr("contentEditable",!1),t.children(":first-child").attr("contentEditable",!0))})}}}),c("tinymce.plugins.toc.ui.Buttons",["tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.Toc"],function(t,e){var n=function(t){return function(n){var o=n.control;t.on("LoadContent SetContent change",function(){o.disabled(t.readonly||!e.hasHeaders(t))})}};return{register:function(e){e.addButton("toc",{tooltip:"Table of Contents",cmd:"mceInsertToc",icon:"toc",onPostRender:n(e)}),e.addButton("tocupdate",{tooltip:"Update",cmd:"mceUpdateToc",icon:"reload"}),e.addMenuItem("toc",{text:"Table of Contents",context:"insert",cmd:"mceInsertToc",onPostRender:n(e)}),e.addContextToolbar(function(e){return function(n){return n&&e.dom.is(n,"."+t.getTocClass(e))&&e.getBody().contains(n)}}(e),"tocupdate")}}}),c("tinymce.plugins.toc.Plugin",["tinymce.core.PluginManager","tinymce.plugins.toc.api.Commands","tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.FilterContent","tinymce.plugins.toc.ui.Buttons"],function(t,e,n,o,i){return t.add("toc",function(t){e.register(t),i.register(t),o.setup(t)}),function(){}}),i("tinymce.plugins.toc.Plugin")()}();