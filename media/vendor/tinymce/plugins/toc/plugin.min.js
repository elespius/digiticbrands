!function(){var t={},n=function(n,e,o){if("string"!=typeof n)throw"module id must be a string";if(void 0===e)throw"no dependencies for "+n;if(void 0===o)throw"no definition function for "+n;t[n]={deps:e,defn:o,instance:void 0}},e=function(n){var o=t[n];if(void 0===o)throw"module ["+n+"] was undefined";return void 0===o.instance&&function(n){for(var o=t[n],i=o.deps,c=o.defn,r=i.length,l=new Array(r),u=0;u<r;++u)l[u]=e(i[u]);var a=c.apply(null,l);if(void 0===a)throw"module ["+n+"] returned undefined";o.instance=a}(n),o.instance},o=function(t,n){for(var o=t.length,i=new Array(o),c=0;c<o;++c)i[c]=e(t[c]);n.apply(null,i)};({}).bolt={module:{api:{define:n,require:o,demand:e}}};var i=n;!function(t,n){i(t,[],function(){return n})}("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve),i("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.PluginManager")}),i("tinymce.core.dom.DOMUtils",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.dom.DOMUtils")}),i("tinymce.core.util.I18n",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.I18n")}),i("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.Tools")}),i("tinymce.plugins.toc.api.Settings",[],function(){return{getTocClass:function(t){return t.getParam("toc_class","mce-toc")},getTocHeader:function(t){var n=t.getParam("toc_header","h2");return/^h[1-6]$/.test(n)?n:"h2"},getTocDepth:function(t){var n=parseInt(t.getParam("toc_depth","3"),10);return n>=1&&n<=9?n:3}}}),i("tinymce.plugins.toc.core.Guid",[],function(){return{create:function(t){var n=0;return function(){var e=(new Date).getTime().toString(32);return t+e+(n++).toString(32)}}}}),i("tinymce.plugins.toc.core.Toc",["tinymce.core.dom.DOMUtils","tinymce.core.util.I18n","tinymce.core.util.Tools","tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.Guid"],function(t,n,e,o,i){var c=i.create("mcetoc_"),r=function(t){var n=o.getTocClass(t),i=o.getTocHeader(t),r=function(t){var n,e=[];for(n=1;n<=t;n++)e.push("h"+n);return e.join(",")}(o.getTocDepth(t)),l=t.$(r);return l.length&&/^h[1-9]$/i.test(i)&&(l=l.filter(function(e,o){return!t.dom.hasClass(o.parentNode,n)})),e.map(l,function(n){return{id:n.id?n.id:c(),level:parseInt(n.nodeName.replace(/^H/i,""),10),title:t.$.text(n),element:n}})},l=function(e){var i,c,l,u,a="",s=r(e),d=function(t){var n,e=9;for(n=0;n<t.length;n++)if(t[n].level<e&&(e=t[n].level),1===e)return e;return e}(s)-1;if(!s.length)return"";for(a+=function(n,e){var o="</"+n+">";return"<"+n+' contenteditable="true">'+t.DOM.encode(e)+o}(o.getTocHeader(e),n.translate("Table of Contents")),i=0;i<s.length;i++){if(l=s[i],l.element.id=l.id,u=s[i+1]&&s[i+1].level,d===l.level)a+="<li>";else for(c=d;c<l.level;c++)a+="<ul><li>";if(a+='<a href="#'+l.id+'">'+l.title+"</a>",u!==l.level&&u)for(c=l.level;c>u;c--)a+="</li></ul><li>";else a+="</li>",u||(a+="</ul>");d=l.level}return a},u=function(t){var n=o.getTocClass(t),e=t.$("."+n);e.length&&t.undoManager.transact(function(){e.html(l(t))})};return{hasHeaders:function(t){return r(t).length>0},insertToc:function(t){var n=o.getTocClass(t);!function(t,n){return!n.length||t.dom.getParents(n[0],".mce-offscreen-selection").length>0}(t,t.$("."+n))?u(t):t.insertContent(function(t){var n=l(t);return'<div class="'+t.dom.encode(o.getTocClass(t))+'" contenteditable="false">'+n+"</div>"}(t))},updateToc:u}}),i("tinymce.plugins.toc.api.Commands",["tinymce.plugins.toc.core.Toc"],function(t){return{register:function(n){n.addCommand("mceInsertToc",function(){t.insertToc(n)}),n.addCommand("mceUpdateToc",function(){t.updateToc(n)})}}}),i("tinymce.plugins.toc.core.FilterContent",["tinymce.plugins.toc.api.Settings"],function(t){return{setup:function(n){var e=n.$,o=t.getTocClass(n);n.on("PreProcess",function(t){var n=e("."+o,t.node);n.length&&(n.removeAttr("contentEditable"),n.find("[contenteditable]").removeAttr("contentEditable"))}),n.on("SetContent",function(){var t=e("."+o);t.length&&(t.attr("contentEditable",!1),t.children(":first-child").attr("contentEditable",!0))})}}}),i("tinymce.plugins.toc.ui.Buttons",["tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.Toc"],function(t,n){var e=function(t){return function(e){var o=e.control;t.on("LoadContent SetContent change",function(){o.disabled(t.readonly||!n.hasHeaders(t))})}};return{register:function(n){n.addButton("toc",{tooltip:"Table of Contents",cmd:"mceInsertToc",icon:"toc",onPostRender:e(n)}),n.addButton("tocupdate",{tooltip:"Update",cmd:"mceUpdateToc",icon:"reload"}),n.addMenuItem("toc",{text:"Table of Contents",context:"insert",cmd:"mceInsertToc",onPostRender:e(n)}),n.addContextToolbar(function(n){return function(e){return e&&n.dom.is(e,"."+t.getTocClass(n))&&n.getBody().contains(e)}}(n),"tocupdate")}}}),i("tinymce.plugins.toc.Plugin",["tinymce.core.PluginManager","tinymce.plugins.toc.api.Commands","tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.FilterContent","tinymce.plugins.toc.ui.Buttons"],function(t,n,e,o,i){return t.add("toc",function(t){n.register(t),i.register(t),o.setup(t)}),function(){}}),e("tinymce.plugins.toc.Plugin")()}();