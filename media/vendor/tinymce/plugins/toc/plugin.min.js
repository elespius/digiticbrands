!function(){var t={},n=function(n){for(var e=t[n],i=e.deps,c=e.defn,r=i.length,l=new Array(r),u=0;u<r;++u)l[u]=o(i[u]);var a=c.apply(null,l);if(void 0===a)throw"module ["+n+"] returned undefined";e.instance=a},e=function(n,e,o){if("string"!=typeof n)throw"module id must be a string";if(void 0===e)throw"no dependencies for "+n;if(void 0===o)throw"no definition function for "+n;t[n]={deps:e,defn:o,instance:void 0}},o=function(e){var o=t[e];if(void 0===o)throw"module ["+e+"] was undefined";return void 0===o.instance&&n(e),o.instance},i=function(t,n){for(var e=t.length,i=new Array(e),c=0;c<e;++c)i[c]=o(t[c]);n.apply(null,i)};({}).bolt={module:{api:{define:e,require:i,demand:o}}};var c=e;!function(t,n){c(t,[],function(){return n})}("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve),c("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.PluginManager")}),c("tinymce.core.dom.DOMUtils",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.dom.DOMUtils")}),c("tinymce.core.util.I18n",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.I18n")}),c("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.Tools")}),c("tinymce.plugins.toc.api.Settings",[],function(){return{getTocClass:function(t){return t.getParam("toc_class","mce-toc")},getTocHeader:function(t){var n=t.getParam("toc_header","h2");return/^h[1-6]$/.test(n)?n:"h2"},getTocDepth:function(t){var n=parseInt(t.getParam("toc_depth","3"),10);return n>=1&&n<=9?n:3}}}),c("tinymce.plugins.toc.core.Guid",[],function(){return{create:function(t){var n=0;return function(){var e=(new Date).getTime().toString(32);return t+e+(n++).toString(32)}}}}),c("tinymce.plugins.toc.core.Toc",["tinymce.core.dom.DOMUtils","tinymce.core.util.I18n","tinymce.core.util.Tools","tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.Guid"],function(t,n,e,o,i){var c=i.create("mcetoc_"),r=function(t){var n,e=[];for(n=1;n<=t;n++)e.push("h"+n);return e.join(",")},l=function(t){var n=o.getTocClass(t),i=o.getTocHeader(t),l=r(o.getTocDepth(t)),u=t.$(l);return u.length&&/^h[1-9]$/i.test(i)&&(u=u.filter(function(e,o){return!t.dom.hasClass(o.parentNode,n)})),e.map(u,function(n){return{id:n.id?n.id:c(),level:parseInt(n.nodeName.replace(/^H/i,""),10),title:t.$.text(n),element:n}})},u=function(t){var n,e=9;for(n=0;n<t.length;n++)if(t[n].level<e&&(e=t[n].level),1===e)return e;return e},a=function(n,e){var o="</"+n+">";return"<"+n+' contenteditable="true">'+t.DOM.encode(e)+o},s=function(t){var n=d(t);return'<div class="'+t.dom.encode(o.getTocClass(t))+'" contenteditable="false">'+n+"</div>"},d=function(t){var e,i,c,r,s="",d=l(t),f=u(d)-1;if(!d.length)return"";for(s+=a(o.getTocHeader(t),n.translate("Table of Contents")),e=0;e<d.length;e++){if(c=d[e],c.element.id=c.id,r=d[e+1]&&d[e+1].level,f===c.level)s+="<li>";else for(i=f;i<c.level;i++)s+="<ul><li>";if(s+='<a href="#'+c.id+'">'+c.title+"</a>",r!==c.level&&r)for(i=c.level;i>r;i--)s+="</li></ul><li>";else s+="</li>",r||(s+="</ul>");f=c.level}return s},f=function(t,n){return!n.length||t.dom.getParents(n[0],".mce-offscreen-selection").length>0},m=function(t){var n=o.getTocClass(t),e=t.$("."+n);e.length&&t.undoManager.transact(function(){e.html(d(t))})};return{hasHeaders:function(t){return l(t).length>0},insertToc:function(t){var n=o.getTocClass(t),e=t.$("."+n);f(t,e)?t.insertContent(s(t)):m(t)},updateToc:m}}),c("tinymce.plugins.toc.api.Commands",["tinymce.plugins.toc.core.Toc"],function(t){return{register:function(n){n.addCommand("mceInsertToc",function(){t.insertToc(n)}),n.addCommand("mceUpdateToc",function(){t.updateToc(n)})}}}),c("tinymce.plugins.toc.core.FilterContent",["tinymce.plugins.toc.api.Settings"],function(t){return{setup:function(n){var e=n.$,o=t.getTocClass(n);n.on("PreProcess",function(t){var n=e("."+o,t.node);n.length&&(n.removeAttr("contentEditable"),n.find("[contenteditable]").removeAttr("contentEditable"))}),n.on("SetContent",function(){var t=e("."+o);t.length&&(t.attr("contentEditable",!1),t.children(":first-child").attr("contentEditable",!0))})}}}),c("tinymce.plugins.toc.ui.Buttons",["tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.Toc"],function(t,n){var e=function(t){return function(e){var o=e.control;t.on("LoadContent SetContent change",function(){o.disabled(t.readonly||!n.hasHeaders(t))})}},o=function(n){return function(e){return e&&n.dom.is(e,"."+t.getTocClass(n))&&n.getBody().contains(e)}};return{register:function(t){t.addButton("toc",{tooltip:"Table of Contents",cmd:"mceInsertToc",icon:"toc",onPostRender:e(t)}),t.addButton("tocupdate",{tooltip:"Update",cmd:"mceUpdateToc",icon:"reload"}),t.addMenuItem("toc",{text:"Table of Contents",context:"insert",cmd:"mceInsertToc",onPostRender:e(t)}),t.addContextToolbar(o(t),"tocupdate")}}}),c("tinymce.plugins.toc.Plugin",["tinymce.core.PluginManager","tinymce.plugins.toc.api.Commands","tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.FilterContent","tinymce.plugins.toc.ui.Buttons"],function(t,n,e,o,i){return t.add("toc",function(t){n.register(t),i.register(t),o.setup(t)}),function(){}}),o("tinymce.plugins.toc.Plugin")()}();