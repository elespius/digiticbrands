!function(){var t={},e=function(e,n,o){if("string"!=typeof e)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+e;if(void 0===o)throw"no definition function for "+e;t[e]={deps:n,defn:o,instance:void 0}},n=function(e){var o=t[e];if(void 0===o)throw"module ["+e+"] was undefined";return void 0===o.instance&&function(e){for(var o=t[e],i=o.deps,c=o.defn,r=i.length,l=new Array(r),u=0;u<r;++u)l[u]=n(i[u]);var a=c.apply(null,l);if(void 0===a)throw"module ["+e+"] returned undefined";o.instance=a}(e),o.instance},o=e;i="global!tinymce.util.Tools.resolve",c=tinymce.util.Tools.resolve,o(i,[],function(){return c});var i,c;o("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.PluginManager")}),o("tinymce.core.dom.DOMUtils",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.dom.DOMUtils")}),o("tinymce.core.util.I18n",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.I18n")}),o("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.Tools")}),o("tinymce.plugins.toc.api.Settings",[],function(){return{getTocClass:function(t){return t.getParam("toc_class","mce-toc")},getTocHeader:function(t){var e=t.getParam("toc_header","h2");return/^h[1-6]$/.test(e)?e:"h2"},getTocDepth:function(t){var e=parseInt(t.getParam("toc_depth","3"),10);return e>=1&&e<=9?e:3}}}),o("tinymce.plugins.toc.core.Guid",[],function(){return{create:function(t){var e=0;return function(){var n=(new Date).getTime().toString(32);return t+n+(e++).toString(32)}}}}),o("tinymce.plugins.toc.core.Toc",["tinymce.core.dom.DOMUtils","tinymce.core.util.I18n","tinymce.core.util.Tools","tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.Guid"],function(t,e,n,o,i){var c=i.create("mcetoc_"),r=function(t){var e=o.getTocClass(t),i=o.getTocHeader(t),r=function(t){var e,n=[];for(e=1;e<=t;e++)n.push("h"+e);return n.join(",")}(o.getTocDepth(t)),l=t.$(r);return l.length&&/^h[1-9]$/i.test(i)&&(l=l.filter(function(n,o){return!t.dom.hasClass(o.parentNode,e)})),n.map(l,function(e){return{id:e.id?e.id:c(),level:parseInt(e.nodeName.replace(/^H/i,""),10),title:t.$.text(e),element:e}})},l=function(n){var i,c,l,u,a="",s=r(n),d=function(t){var e,n=9;for(e=0;e<t.length;e++)if(t[e].level<n&&(n=t[e].level),1===n)return n;return n}(s)-1;if(!s.length)return"";for(a+=function(e,n){var o="</"+e+">";return"<"+e+' contenteditable="true">'+t.DOM.encode(n)+o}(o.getTocHeader(n),e.translate("Table of Contents")),i=0;i<s.length;i++){if((l=s[i]).element.id=l.id,u=s[i+1]&&s[i+1].level,d===l.level)a+="<li>";else for(c=d;c<l.level;c++)a+="<ul><li>";if(a+='<a href="#'+l.id+'">'+l.title+"</a>",u!==l.level&&u)for(c=l.level;c>u;c--)a+="</li></ul><li>";else a+="</li>",u||(a+="</ul>");d=l.level}return a},u=function(t){var e=o.getTocClass(t),n=t.$("."+e);n.length&&t.undoManager.transact(function(){n.html(l(t))})};return{hasHeaders:function(t){return r(t).length>0},insertToc:function(t){var e=o.getTocClass(t),n=t.$("."+e);i=t,!(c=n).length||i.dom.getParents(c[0],".mce-offscreen-selection").length>0?t.insertContent(function(t){var e=l(t);return'<div class="'+t.dom.encode(o.getTocClass(t))+'" contenteditable="false">'+e+"</div>"}(t)):u(t);var i,c},updateToc:u}}),o("tinymce.plugins.toc.api.Commands",["tinymce.plugins.toc.core.Toc"],function(t){return{register:function(e){e.addCommand("mceInsertToc",function(){t.insertToc(e)}),e.addCommand("mceUpdateToc",function(){t.updateToc(e)})}}}),o("tinymce.plugins.toc.core.FilterContent",["tinymce.plugins.toc.api.Settings"],function(t){return{setup:function(e){var n=e.$,o=t.getTocClass(e);e.on("PreProcess",function(t){var e=n("."+o,t.node);e.length&&(e.removeAttr("contentEditable"),e.find("[contenteditable]").removeAttr("contentEditable"))}),e.on("SetContent",function(){var t=n("."+o);t.length&&(t.attr("contentEditable",!1),t.children(":first-child").attr("contentEditable",!0))})}}}),o("tinymce.plugins.toc.ui.Buttons",["tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.Toc"],function(t,e){var n=function(t){return function(n){var o=n.control;t.on("LoadContent SetContent change",function(){o.disabled(t.readonly||!e.hasHeaders(t))})}};return{register:function(e){e.addButton("toc",{tooltip:"Table of Contents",cmd:"mceInsertToc",icon:"toc",onPostRender:n(e)}),e.addButton("tocupdate",{tooltip:"Update",cmd:"mceUpdateToc",icon:"reload"}),e.addMenuItem("toc",{text:"Table of Contents",context:"insert",cmd:"mceInsertToc",onPostRender:n(e)}),e.addContextToolbar((o=e,function(e){return e&&o.dom.is(e,"."+t.getTocClass(o))&&o.getBody().contains(e)}),"tocupdate");var o}}}),o("tinymce.plugins.toc.Plugin",["tinymce.core.PluginManager","tinymce.plugins.toc.api.Commands","tinymce.plugins.toc.api.Settings","tinymce.plugins.toc.core.FilterContent","tinymce.plugins.toc.ui.Buttons"],function(t,e,n,o,i){return t.add("toc",function(t){e.register(t),i.register(t),o.setup(t)}),function(){}}),n("tinymce.plugins.toc.Plugin")()}();