!function(){var t={},e=function(e,n,o){if("string"!=typeof e)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+e;if(void 0===o)throw"no definition function for "+e;t[e]={deps:n,defn:o,instance:void 0}},n=function(e){var o=t[e];if(void 0===o)throw"module ["+e+"] was undefined";return void 0===o.instance&&function(e){for(var o=t[e],r=o.deps,i=o.defn,a=r.length,u=new Array(a),c=0;c<a;++c)u[c]=n(r[c]);var l=i.apply(null,u);if(void 0===l)throw"module ["+e+"] returned undefined";o.instance=l}(e),o.instance},o=e,r=function(t,e){o(t,[],function(){return e})};o("ephox.katamari.api.Cell",[],function(){var t=function(e){var n=e,o=function(){return n};return{get:o,set:function(t){n=t},clone:function(){return t(o())}}};return t}),r("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve),o("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.PluginManager")}),o("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.Tools")}),o("ephox.imagetools.util.Canvas",[],function(){function t(t,e){return n(document.createElement("canvas"),t,e)}function e(t){return t.getContext("2d")}function n(t,e,n){return t.width=e,t.height=n,t}return{create:t,clone:function(n){var o;return e(o=t(n.width,n.height)).drawImage(n,0,0),o},resize:n,get2dContext:e,get3dContext:function(t){var e=null;try{e=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(t){}return e||(e=null),e}}}),o("ephox.imagetools.util.ImageSize",[],function(){return{getWidth:function(t){return t.naturalWidth||t.width},getHeight:function(t){return t.naturalHeight||t.height}}}),o("ephox.imagetools.util.Promise",[],function(){if(window.Promise)return window.Promise;var t=o.immediateFn||"function"==typeof setImmediate&&setImmediate||function(t){setTimeout(t,1)};function e(t,e){return function(){t.apply(e,arguments)}}var n=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function o(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],c(t,e(i,this),e(a,this))}function r(e){var n=this;null!==this._state?t(function(){var t=n._state?e.onFulfilled:e.onRejected;if(null!==t){var o;try{o=t(n._value)}catch(t){return void e.reject(t)}e.resolve(o)}else(n._state?e.resolve:e.reject)(n._value)}):this._deferreds.push(e)}function i(t){try{if(t===this)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void c(e(n,t),e(i,this),e(a,this))}this._state=!0,this._value=t,u.call(this)}catch(t){a.call(this,t)}}function a(t){this._state=!1,this._value=t,u.call(this)}function u(){for(var t=0,e=this._deferreds.length;t<e;t++)r.call(this,this._deferreds[t]);this._deferreds=null}function c(t,e,n){var o=!1;try{t(function(t){o||(o=!0,e(t))},function(t){o||(o=!0,n(t))})}catch(t){if(o)return;o=!0,n(t)}}return o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var n=this;return new o(function(o,i){r.call(n,new function(t,e,n,o){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=o}(t,e,o,i))})},o.all=function(){var t=Array.prototype.slice.call(1===arguments.length&&n(arguments[0])?arguments[0]:arguments);return new o(function(e,n){if(0===t.length)return e([]);var o=t.length;function r(i,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return void u.call(a,function(t){r(i,t)},n)}t[i]=a,0==--o&&e(t)}catch(t){n(t)}}for(var i=0;i<t.length;i++)r(i,t[i])})},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(t){return new o(function(e,n){n(t)})},o.race=function(t){return new o(function(e,n){for(var o=0,r=t.length;o<r;o++)t[o].then(e,n)})},o}),r("global!Array",Array),r("global!Error",Error),o("ephox.katamari.api.Fun",["global!Array","global!Error"],function(t,e){var n=function(t){return function(){return t}};return{noop:function(){},noarg:function(t){return function(){return t()}},compose:function(t,e){return function(){return t(e.apply(null,arguments))}},constant:n,identity:function(t){return t},tripleEquals:function(t,e){return t===e},curry:function(e){for(var n=new t(arguments.length-1),o=1;o<arguments.length;o++)n[o-1]=arguments[o];return function(){for(var o=new t(arguments.length),r=0;r<o.length;r++)o[r]=arguments[r];var i=n.concat(o);return e.apply(null,i)}},not:function(t){return function(){return!t.apply(null,arguments)}},die:function(t){return function(){throw new e(t)}},apply:function(t){return t()},call:function(t){t()},never:n(!1),always:n(!0)}}),r("global!Object",Object),o("ephox.katamari.api.Option",["ephox.katamari.api.Fun","global!Object"],function(t,e){var n=t.never,o=t.always,r=function(){return i},i=function(){var i=function(t){return t.isNone()},a=function(t){return t()},u=function(t){return t},c={fold:function(t,e){return t()},is:n,isSome:n,isNone:o,getOr:u,getOrThunk:a,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},or:u,orThunk:a,map:r,ap:r,each:function(){},bind:r,flatten:r,exists:n,forall:o,filter:r,equals:i,equals_:i,toArray:function(){return[]},toString:t.constant("none()")};return e.freeze&&e.freeze(c),c}(),a=function(t){var e=function(){return t},u=function(){return l},c=function(e){return e(t)},l={fold:function(e,n){return n(t)},is:function(e){return t===e},isSome:o,isNone:n,getOr:e,getOrThunk:e,getOrDie:e,or:u,orThunk:u,map:function(e){return a(e(t))},ap:function(e){return e.fold(r,function(e){return a(e(t))})},each:function(e){e(t)},bind:c,flatten:e,exists:c,forall:c,filter:function(e){return e(t)?l:i},equals:function(e){return e.is(t)},equals_:function(e,o){return e.fold(n,function(e){return o(t,e)})},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return l};return{some:a,none:r,from:function(t){return null===t||void 0===t?i:a(t)}}}),o("ephox.katamari.api.Global",[],function(){return"undefined"!=typeof window?window:Function("return this;")()}),o("ephox.katamari.api.Resolve",["ephox.katamari.api.Global"],function(t){var e=function(e,n){for(var o=void 0!==n?n:t,r=0;r<e.length&&void 0!==o&&null!==o;++r)o=o[e[r]];return o},n=function(e,n){for(var o=void 0!==n?n:t,r=0;r<e.length;++r)i=o,a=e[r],void 0!==i[a]&&null!==i[a]||(i[a]={}),o=i[a];var i,a;return o};return{path:e,resolve:function(t,n){var o=t.split(".");return e(o,n)},forge:n,namespace:function(t,e){var o=t.split(".");return n(o,e)}}}),o("ephox.sand.util.Global",["ephox.katamari.api.Resolve"],function(t){return{getOrDie:function(e,n){var o,r,i=(o=e,r=n,t.resolve(o,r));if(void 0===i)throw e+" not available on this browser";return i}}}),o("ephox.sand.api.Blob",["ephox.sand.util.Global"],function(t){return function(e,n){return new(t.getOrDie("Blob"))(e,n)}}),o("ephox.sand.api.FileReader",["ephox.sand.util.Global"],function(t){return function(){return new(t.getOrDie("FileReader"))}}),o("ephox.sand.api.Uint8Array",["ephox.sand.util.Global"],function(t){return function(e){return new(t.getOrDie("Uint8Array"))(e)}}),o("ephox.sand.api.Window",["ephox.sand.util.Global"],function(t){return{atob:function(e){return t.getOrDie("atob")(e)},requestAnimationFrame:function(e){t.getOrDie("requestAnimationFrame")(e)}}}),r("global!Math",Math),o("ephox.imagetools.util.Conversions",["ephox.imagetools.util.Canvas","ephox.imagetools.util.ImageSize","ephox.imagetools.util.Promise","ephox.katamari.api.Option","ephox.sand.api.Blob","ephox.sand.api.FileReader","ephox.sand.api.Uint8Array","ephox.sand.api.Window","global!Array","global!Math"],function(t,e,n,o,r,i,a,u,c,l){function s(t){return new n(function(e,n){var o=URL.createObjectURL(t),r=new Image,i=function(){r.removeEventListener("load",a),r.removeEventListener("error",u)};function a(){i(),e(r)}function u(){i(),n("Unable to load data of type "+t.type+": "+o)}r.addEventListener("load",a),r.addEventListener("error",u),r.src=o,r.complete&&a()})}function f(t){return new n(function(e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="blob",n.onload=function(){200==this.status&&e(this.response)},n.send()})}function m(t){var e=t.split(","),n=/data:([^;]+)/.exec(e[0]);if(!n)return o.none();for(var i=n[1],s=e[1],f=u.atob(s),m=f.length,g=l.ceil(m/1024),p=new c(g),d=0;d<g;++d){for(var h=1024*d,v=l.min(h+1024,m),y=new c(v-h),b=h,x=0;b<v;++x,++b)y[x]=f[b].charCodeAt(0);p[d]=a(y)}return o.some(r(p,{type:i}))}function g(t){return new n(function(e,n){m(t).fold(function(){n("uri is not base64: "+t)},e)})}function p(t){return new n(function(e){var n=new i;n.onloadend=function(){e(n.result)},n.readAsDataURL(t)})}return{blobToImage:s,imageToBlob:function(t){return(e=t,new n(function(t){function n(){e.removeEventListener("load",n),t(e)}e.complete?t(e):e.addEventListener("load",n)})).then(function(t){var e=t.src;return 0===e.indexOf("blob:")?f(e):0===e.indexOf("data:")?g(e):f(e)});var e},blobToDataUri:p,blobToBase64:function(t){return p(t).then(function(t){return t.split(",")[1]})},dataUriToBlobSync:m,canvasToBlob:function(t,e,o){return e=e||"image/png",HTMLCanvasElement.prototype.toBlob?new n(function(n){t.toBlob(function(t){n(t)},e,o)}):g(t.toDataURL(e,o))},canvasToDataURL:function(t,e,n){return e=e||"image/png",t.then(function(t){return t.toDataURL(e,n)})},blobToCanvas:function(n){return s(n).then(function(n){o=n,URL.revokeObjectURL(o.src);var o,r;return r=t.create(e.getWidth(n),e.getHeight(n)),t.get2dContext(r).drawImage(n,0,0),r})},uriToBlob:function(t){return 0===t.indexOf("blob:")?f(t):0===t.indexOf("data:")?g(t):null}}}),o("ephox.imagetools.api.BlobConversions",["ephox.imagetools.util.Conversions","ephox.katamari.api.Option"],function(t,e){return{blobToImage:function(e){return t.blobToImage(e)},imageToBlob:function(e){return t.imageToBlob(e)},blobToDataUri:function(e){return t.blobToDataUri(e)},blobToBase64:function(e){return t.blobToBase64(e)},dataUriToBlobSync:function(e){return t.dataUriToBlobSync(e)},uriToBlob:function(n){return e.from(t.uriToBlob(n))}}}),o("ephox.imagetools.util.ImageResult",["ephox.imagetools.util.Canvas","ephox.imagetools.util.Conversions","ephox.imagetools.util.Promise","ephox.katamari.api.Fun"],function(t,e,n,o){function r(r,i,a){var u=i.type;function c(t,n){return r.then(function(o){return e.canvasToDataURL(o,t,n)})}return{getType:o.constant(u),toBlob:function(){return n.resolve(i)},toDataURL:function(){return a},toBase64:function(){return a.split(",")[1]},toAdjustedBlob:function(t,n){return r.then(function(o){return e.canvasToBlob(o,t,n)})},toAdjustedDataURL:c,toAdjustedBase64:function(t,e){return c(t,e).then(function(t){return t.split(",")[1]})},toCanvas:function(){return r.then(t.clone)}}}function i(t){return e.blobToDataUri(t).then(function(n){return r(e.blobToCanvas(t),t,n)})}return{fromBlob:i,fromCanvas:function(t,o){return e.canvasToBlob(t,o).then(function(e){return r(n.resolve(t),e,t.toDataURL())})},fromImage:function(t){return e.imageToBlob(t).then(function(t){return i(t)})},fromBlobAndUrlSync:function(t,n){return r(e.blobToCanvas(t),t,n)}}}),o("ephox.imagetools.transformations.ColorMatrix",[],function(){function t(t,e,n){return(t=parseFloat(t))>n?t=n:t<e&&(t=e),t}var e=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];function n(t,e){var n,o,r,i,a=[],u=new Array(10);for(n=0;n<5;n++){for(o=0;o<5;o++)a[o]=e[o+5*n];for(o=0;o<5;o++){for(i=0,r=0;r<5;r++)i+=t[o+5*r]*a[r];u[o+5*n]=i}}return u}function o(e,n){return n=t(n,0,1),e.map(function(e,o){return o%6==0?e=1-(1-e)*n:e*=n,t(e,0,1)})}return{identity:function(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},adjust:o,multiply:n,adjustContrast:function(o,r){var i;return r=t(r,-1,1),n(o,[(i=(r*=100)<0?127+r/100*127:127*(i=0==(i=r%1)?e[r]:e[Math.floor(r)]*(1-i)+e[Math.floor(r)+1]*i)+127)/127,0,0,0,.5*(127-i),0,i/127,0,0,.5*(127-i),0,0,i/127,0,.5*(127-i),0,0,0,1,0,0,0,0,0,1])},adjustBrightness:function(e,o){return n(e,[1,0,0,0,o=t(255*o,-255,255),0,1,0,0,o,0,0,1,0,o,0,0,0,1,0,0,0,0,0,1])},adjustSaturation:function(e,o){var r;return n(e,[.3086*(1-(r=1+((o=t(o,-1,1))>0?3*o:o)))+r,.6094*(1-r),.082*(1-r),0,0,.3086*(1-r),.6094*(1-r)+r,.082*(1-r),0,0,.3086*(1-r),.6094*(1-r),.082*(1-r)+r,0,0,0,0,0,1,0,0,0,0,0,1])},adjustHue:function(e,o){var r,i;return o=t(o,-180,180)/180*Math.PI,n(e,[.213+.787*(r=Math.cos(o))+-.213*(i=Math.sin(o)),.715+-.715*r+-.715*i,.072+-.072*r+.928*i,0,0,.213+-.213*r+.143*i,.715+r*(1-.715)+.14*i,.072+-.072*r+-.283*i,0,0,.213+-.213*r+-.787*i,.715+-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,0,1,0,0,0,0,0,1])},adjustColors:function(e,o,r,i){return n(e,[o=t(o,0,2),0,0,0,0,0,r=t(r,0,2),0,0,0,0,0,i=t(i,0,2),0,0,0,0,0,1,0,0,0,0,0,1])},adjustSepia:function(e,r){return n(e,o([.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0,0,0,0,0,1],r=t(r,0,1)))},adjustGrayscale:function(e,r){return n(e,o([.33,.34,.33,0,0,.33,.34,.33,0,0,.33,.34,.33,0,0,0,0,0,1,0,0,0,0,0,1],r=t(r,0,1)))}}}),o("ephox.imagetools.transformations.Filters",["ephox.imagetools.util.Canvas","ephox.imagetools.util.ImageResult","ephox.imagetools.transformations.ColorMatrix"],function(t,e,n){function o(n,o){return n.toCanvas().then(function(r){return function(n,o,r){var i,a=t.get2dContext(n);return i=function(t,e){var n,o,r,i,a,u=t.data,c=e[0],l=e[1],s=e[2],f=e[3],m=e[4],g=e[5],p=e[6],d=e[7],h=e[8],v=e[9],y=e[10],b=e[11],x=e[12],w=e[13],R=e[14],I=e[15],T=e[16],k=e[17],C=e[18],U=e[19];for(a=0;a<u.length;a+=4)n=u[a],o=u[a+1],r=u[a+2],i=u[a+3],u[a]=n*c+o*l+r*s+i*f+m,u[a+1]=n*g+o*p+r*d+i*h+v,u[a+2]=n*y+o*b+r*x+i*w+R,u[a+3]=n*I+o*T+r*k+i*C+U;return t}(a.getImageData(0,0,n.width,n.height),r),a.putImageData(i,0,0),e.fromCanvas(n,o)}(r,n.getType(),o)})}function r(n,o){return n.toCanvas().then(function(r){return function(n,o,r){var i,a,u=t.get2dContext(n);return i=u.getImageData(0,0,n.width,n.height),a=u.getImageData(0,0,n.width,n.height),a=function(t,e,n){var o,r,i,a,u,c,l,s,f,m,g,p,d,h,v,y,b;function x(t,e,n){return t>n?t=n:t<e&&(t=e),t}for(i=Math.round(Math.sqrt(n.length)),a=Math.floor(i/2),o=t.data,r=e.data,y=t.width,b=t.height,c=0;c<b;c++)for(u=0;u<y;u++){for(l=s=f=0,g=0;g<i;g++)for(m=0;m<i;m++)p=x(u+m-a,0,y-1),d=x(c+g-a,0,b-1),h=4*(d*y+p),v=n[g*i+m],l+=o[h]*v,s+=o[h+1]*v,f+=o[h+2]*v;r[h=4*(c*y+u)]=x(l,0,255),r[h+1]=x(s,0,255),r[h+2]=x(f,0,255)}return e}(i,a,r),u.putImageData(a,0,0),e.fromCanvas(n,o)}(r,n.getType(),o)})}function i(n){return function(o,r){return o.toCanvas().then(function(i){return function(o,r,i){var a,u,c=t.get2dContext(o),l=new Array(256);for(u=0;u<l.length;u++)l[u]=n(u,i);return a=function(t,e){var n,o=t.data;for(n=0;n<o.length;n+=4)o[n]=e[o[n]],o[n+1]=e[o[n+1]],o[n+2]=e[o[n+2]];return t}(c.getImageData(0,0,o.width,o.height),l),c.putImageData(a,0,0),e.fromCanvas(o,r)}(i,o.getType(),r)})}}function a(t){return function(e,r){return o(e,t(n.identity(),r))}}function u(t){return function(e){return r(e,t)}}return{invert:(c=[-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],function(t){return o(t,c)}),brightness:a(n.adjustBrightness),hue:a(n.adjustHue),saturate:a(n.adjustSaturation),contrast:a(n.adjustContrast),grayscale:a(n.adjustGrayscale),sepia:a(n.adjustSepia),colorize:function(t,e,r,i){return o(t,n.adjustColors(n.identity(),e,r,i))},sharpen:u([0,-1,0,-1,5,-1,0,-1,0]),emboss:u([-2,-1,0,-1,1,1,0,1,2]),gamma:i(function(t,e){return 255*Math.pow(t/255,1-e)}),exposure:i(function(t,e){return 255*(1-Math.exp(-t/255*e))}),colorFilter:o,convoluteFilter:r};var c}),o("ephox.imagetools.transformations.ImageResizerCanvas",["ephox.imagetools.util.Canvas","ephox.imagetools.util.ImageSize","ephox.imagetools.util.Promise"],function(t,e,n){return{scale:function o(r,i,a){var u=e.getWidth(r),c=e.getHeight(r),l=i/u,s=a/c,f=!1;(l<.5||l>2)&&(l=l<.5?.5:2,f=!0),(s<.5||s>2)&&(s=s<.5?.5:2,f=!0);var m,g,p,d=(m=r,g=l,p=s,new n(function(n){var o=e.getWidth(m),r=e.getHeight(m),i=Math.floor(o*g),a=Math.floor(r*p),u=t.create(i,a),c=t.get2dContext(u);c.drawImage(m,0,0,o,r,0,0,i,a),n(u)}));return f?d.then(function(t){return o(t,i,a)}):d}}}),o("ephox.imagetools.transformations.ImageTools",["ephox.imagetools.util.Canvas","ephox.imagetools.util.ImageResult","ephox.imagetools.transformations.ImageResizerCanvas"],function(t,e,n){return{rotate:function(n,o){return n.toCanvas().then(function(r){return function(n,o,r){var i=t.create(n.width,n.height),a=t.get2dContext(i),u=0,c=0;return 90!=(r=r<0?360+r:r)&&270!=r||t.resize(i,i.height,i.width),90!=r&&180!=r||(u=i.width),270!=r&&180!=r||(c=i.height),a.translate(u,c),a.rotate(r*Math.PI/180),a.drawImage(n,0,0),e.fromCanvas(i,o)}(r,n.getType(),o)})},flip:function(n,o){return n.toCanvas().then(function(r){return function(n,o,r){var i=t.create(n.width,n.height),a=t.get2dContext(i);return"v"==r?(a.scale(1,-1),a.drawImage(n,0,-i.height)):(a.scale(-1,1),a.drawImage(n,-i.width,0)),e.fromCanvas(i,o)}(r,n.getType(),o)})},crop:function(n,o,r,i,a){return n.toCanvas().then(function(u){return function(n,o,r,i,a,u){var c=t.create(a,u);return t.get2dContext(c).drawImage(n,-r,-i),e.fromCanvas(c,o)}(u,n.getType(),o,r,i,a)})},resize:function(t,o,r){return t.toCanvas().then(function(i){return n.scale(i,o,r).then(function(n){return e.fromCanvas(n,t.getType())})})}}}),o("ephox.imagetools.api.ImageTransformations",["ephox.imagetools.transformations.Filters","ephox.imagetools.transformations.ImageTools"],function(t,e){return{invert:function(e){return t.invert(e)},sharpen:function(e){return t.sharpen(e)},emboss:function(e){return t.emboss(e)},brightness:function(e,n){return t.brightness(e,n)},hue:function(e,n){return t.hue(e,n)},saturate:function(e,n){return t.saturate(e,n)},contrast:function(e,n){return t.contrast(e,n)},grayscale:function(e,n){return t.grayscale(e,n)},sepia:function(e,n){return t.sepia(e,n)},colorize:function(e,n,o,r){return t.colorize(e,n,o,r)},gamma:function(e,n){return t.gamma(e,n)},exposure:function(e,n){return t.exposure(e,n)},flip:function(t,n){return e.flip(t,n)},crop:function(t,n,o,r,i){return e.crop(t,n,o,r,i)},resize:function(t,n,o){return e.resize(t,n,o)},rotate:function(t,n){return e.rotate(t,n)}}}),o("ephox.imagetools.api.ResultConversions",["ephox.imagetools.util.ImageResult"],function(t){var e=function(t){return t.toBlob()};return{blobToImageResult:function(e){return t.fromBlob(e)},fromBlobAndUrlSync:function(e,n){return t.fromBlobAndUrlSync(e,n)},imageToImageResult:function(e){return t.fromImage(e)},imageResultToBlob:function(t,n,o){return void 0===n&&void 0===o?e(t):t.toAdjustedBlob(n,o)},imageResultToOriginalBlob:e,imageResultToDataURL:function(t){return t.toDataURL()}}}),o("ephox.sand.api.URL",["ephox.sand.util.Global"],function(t){var e=function(){return t.getOrDie("URL")};return{createObjectURL:function(t){return e().createObjectURL(t)},revokeObjectURL:function(t){e().revokeObjectURL(t)}}}),r("global!clearTimeout",clearTimeout),o("tinymce.core.util.Delay",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.Delay")}),o("tinymce.core.util.Promise",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.Promise")}),o("tinymce.core.util.URI",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.URI")}),o("tinymce.plugins.imagetools.api.Settings",[],function(){return{getToolbarItems:function(t){return t.getParam("imagetools_toolbar","rotateleft rotateright | flipv fliph | crop editimage imageoptions")},getProxyUrl:function(t){return t.getParam("imagetools_proxy")}}}),o("tinymce.plugins.imagetools.core.ImageSize",[],function(){return{getImageSize:function(t){var e,n;function o(t){return/^[0-9\.]+px$/.test(t)}return e=t.style.width,n=t.style.height,e||n?o(e)&&o(n)?{w:parseInt(e,10),h:parseInt(n,10)}:null:(e=t.width,n=t.height,e&&n?{w:parseInt(e,10),h:parseInt(n,10)}:null)},setImageSize:function(t,e){var n,o;e&&(n=t.style.width,o=t.style.height,(n||o)&&(t.style.width=e.w+"px",t.style.height=e.h+"px",t.removeAttribute("data-mce-style")),n=t.width,o=t.height,(n||o)&&(t.setAttribute("width",e.w),t.setAttribute("height",e.h)))},getNaturalImageSize:function(t){return{w:t.naturalWidth,h:t.naturalHeight}}}}),r("global!String",String),o("ephox.katamari.api.Arr",["ephox.katamari.api.Option","global!Array","global!Error","global!String"],function(t,e,n,o){var r=function(){var t=e.prototype.indexOf;return void 0===t?function(t,e){return f(t,e)}:function(e,n){return t.call(e,n)}}(),i=function(t,e){return r(t,e)>-1},a=function(t,n){for(var o=t.length,r=new e(o),i=0;i<o;i++){var a=t[i];r[i]=n(a,i,t)}return r},u=function(t,e){for(var n=0,o=t.length;n<o;n++){e(t[n],n,t)}},c=function(t,e){for(var n=t.length-1;n>=0;n--){e(t[n],n,t)}},l=function(t,e){for(var n=[],o=0,r=t.length;o<r;o++){var i=t[o];e(i,o,t)&&n.push(i)}return n},s=function(e,n){for(var o=0,r=e.length;o<r;o++){if(n(e[o],o,e))return t.some(o)}return t.none()},f=function(t,e){for(var n=0,o=t.length;n<o;++n)if(t[n]===e)return n;return-1},m=e.prototype.push,g=function(t){for(var o=[],r=0,i=t.length;r<i;++r){if(!e.prototype.isPrototypeOf(t[r]))throw new n("Arr.flatten item "+r+" was not an array, input: "+t);m.apply(o,t[r])}return o},p=function(t,e){for(var n=0,o=t.length;n<o;++n){if(!0!==e(t[n],n,t))return!1}return!0},d=e.prototype.slice;return{map:a,each:u,eachr:c,partition:function(t,e){for(var n=[],o=[],r=0,i=t.length;r<i;r++){var a=t[r];(e(a,r,t)?n:o).push(a)}return{pass:n,fail:o}},filter:l,groupBy:function(t,e){if(0===t.length)return[];for(var n=e(t[0]),o=[],r=[],i=0,a=t.length;i<a;i++){var u=t[i],c=e(u);c!==n&&(o.push(r),r=[]),n=c,r.push(u)}return 0!==r.length&&o.push(r),o},indexOf:function(e,n){var o=r(e,n);return-1===o?t.none():t.some(o)},foldr:function(t,e,n){return c(t,function(t){n=e(n,t)}),n},foldl:function(t,e,n){return u(t,function(t){n=e(n,t)}),n},find:function(e,n){for(var o=0,r=e.length;o<r;o++){var i=e[o];if(n(i,o,e))return t.some(i)}return t.none()},findIndex:s,flatten:g,bind:function(t,e){var n=a(t,e);return g(n)},forall:p,exists:function(t,e){return s(t,e).isSome()},contains:i,equal:function(t,e){return t.length===e.length&&p(t,function(t,n){return t===e[n]})},reverse:function(t){var e=d.call(t,0);return e.reverse(),e},chunk:function(t,e){for(var n=[],o=0;o<t.length;o+=e){var r=t.slice(o,o+e);n.push(r)}return n},difference:function(t,e){return l(t,function(t){return!i(e,t)})},mapToObject:function(t,e){for(var n={},r=0,i=t.length;r<i;r++){var a=t[r];n[o(a)]=e(a,r)}return n},pure:function(t){return[t]},sort:function(t,e){var n=d.call(t,0);return n.sort(e),n},range:function(t,e){for(var n=[],o=0;o<t;o++)n.push(e(o));return n},head:function(e){return 0===e.length?t.none():t.some(e[0])},last:function(e){return 0===e.length?t.none():t.some(e[e.length-1])}}}),o("ephox.sand.api.XMLHttpRequest",["ephox.sand.util.Global"],function(t){return function(){return new(t.getOrDie("XMLHttpRequest"))}}),o("tinymce.plugins.imagetools.core.Utils",["ephox.sand.api.FileReader","ephox.sand.api.XMLHttpRequest","tinymce.core.util.Promise","tinymce.core.util.Tools"],function(t,e,n,o){var r=function(t){return null!==t&&void 0!==t};return{traverse:function(t,e){var n;return n=e.reduce(function(t,e){return r(t)?t[e]:void 0},t),r(n)?n:null},readBlob:function(e){return new n(function(n){var o=new t;o.onload=function(t){var e=t.target;n(e.result)},o.readAsText(e)})},requestUrlAsBlob:function(t,r){return new n(function(n){var i;(i=new e).onreadystatechange=function(){4===i.readyState&&n({status:i.status,blob:this.response})},i.open("GET",t,!0),o.each(r,function(t,e){i.setRequestHeader(e,t)}),i.responseType="blob",i.send()})},parseJson:function(t){var e;try{e=JSON.parse(t)}catch(t){}return e}}}),o("tinymce.plugins.imagetools.core.Errors",["ephox.katamari.api.Arr","ephox.katamari.api.Fun","tinymce.core.util.Promise","tinymce.plugins.imagetools.core.Utils"],function(t,e,n,o){var r=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],i=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],a=function(n){return"ImageProxy HTTP error: "+t.find(r,function(t){return n===t.code}).fold(e.constant("Unknown ImageProxy error"),function(t){return t.message})},u=function(t){var e=a(t);return n.reject(e)},c=function(n){return t.find(i,function(t){return t.type===n}).fold(e.constant("Unknown service error"),function(t){return t.message})},l=function(t,e){return o.readBlob(e).then(function(t){var e=function(t){var e=o.parseJson(t),n=o.traverse(e,["error","type"]);return"ImageProxy Service error: "+(n?c(n):"Invalid JSON in service error message")}(t);return n.reject(e)})};return{handleServiceErrorResponse:function(t,e){return 400===(n=t)||403===n||500===n?l(0,e):u(t);var n},handleHttpError:u,getHttpErrorMsg:a,getServiceErrorMsg:c}}),o("tinymce.plugins.imagetools.core.Proxy",["tinymce.core.util.Promise","tinymce.core.util.Tools","tinymce.plugins.imagetools.core.Errors","tinymce.plugins.imagetools.core.Utils"],function(t,e,n,o){var r=function(e,r){return o.requestUrlAsBlob(function(t,e){var n=-1===t.indexOf("?")?"?":"&";return/[?&]apiKey=/.test(t)||!e?t:t+n+"apiKey="+encodeURIComponent(e)}(e,r),{"Content-Type":"application/json;charset=UTF-8","tiny-api-key":r}).then(function(e){return e.status<200||e.status>=300?n.handleServiceErrorResponse(e.status,e.blob):t.resolve(e.blob)})};return{getUrl:function(e,i){return i?r(e,i):(a=e,o.requestUrlAsBlob(a,{}).then(function(e){return e.status<200||e.status>=300?n.handleHttpError(e.status):t.resolve(e.blob)}));var a}}}),r("global!setTimeout",setTimeout),o("tinymce.core.dom.DOMUtils",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.dom.DOMUtils")}),o("tinymce.core.ui.Factory",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.ui.Factory")}),o("tinymce.plugins.imagetools.core.UndoStack",[],function(){return function(){var t=[],e=-1;function n(){return e>0}function o(){return-1!==e&&e<t.length-1}return{data:t,add:function(n){var o;return o=t.splice(++e),t.push(n),{state:n,removed:o}},undo:function(){if(n())return t[--e]},redo:function(){if(o())return t[++e]},canUndo:n,canRedo:o}}}),r("global!document",document),r("global!Image",Image),o("tinymce.core.geom.Rect",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.geom.Rect")}),o("tinymce.plugins.imagetools.core.LoadImage",["tinymce.core.util.Promise"],function(t){return{loadImage:function(e){return new t(function(t){var n=function(){e.removeEventListener("load",n),t(e)};e.complete?t(e):e.addEventListener("load",n)})}}}),o("tinymce.core.dom.DomQuery",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.dom.DomQuery")}),o("tinymce.core.util.Observable",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.Observable")}),o("tinymce.core.util.VK",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.VK")}),o("tinymce.plugins.imagetools.ui.CropRect",["tinymce.core.dom.DomQuery","tinymce.core.geom.Rect","tinymce.core.ui.Factory","tinymce.core.util.Observable","tinymce.core.util.Tools","tinymce.core.util.VK"],function(t,e,n,o,r,i){var a=0;return function(u,c,l,s,f){var m,g,p,d,h="mce-",v=h+"crid-"+a++;g=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0,label:"Crop Mask"},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1,label:"Top Left Crop Handle"},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1,label:"Top Right Crop Handle"},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1,label:"Bottom Left Crop Handle"},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1,label:"Bottom Right Crop Handle"}],d=["top","right","bottom","left"];function y(t,e){return{x:e.x-t.x,y:e.y-t.y,w:e.w,h:e.h}}function b(t,n,o,r){var i,a,c,s,f;i=n.x,a=n.y,c=n.w,s=n.h,i+=o*t.deltaX,a+=r*t.deltaY,c+=o*t.deltaW,s+=r*t.deltaH,c<20&&(c=20),s<20&&(s=20),f=u=e.clamp({x:i,y:a,w:c,h:s},l,"move"===t.name),f=y(l,f),m.fire("updateRect",{rect:f}),R(f)}function x(e){function n(e,n){n.h<0&&(n.h=0),n.w<0&&(n.w=0),t("#"+v+"-"+e,s).css({left:n.x,top:n.y,width:n.w,height:n.h})}r.each(g,function(n){t("#"+v+"-"+n.name,s).css({left:e.w*n.xMul+e.x,top:e.h*n.yMul+e.y})}),n("top",{x:c.x,y:c.y,w:c.w,h:e.y-c.y}),n("right",{x:e.x+e.w,y:e.y,w:c.w-e.x-e.w+c.x,h:e.h}),n("bottom",{x:c.x,y:e.y+e.h,w:c.w,h:c.h-e.y-e.h+c.y}),n("left",{x:c.x,y:e.y,w:e.x-c.x,h:e.h}),n("move",e)}function w(t){x(u=t)}function R(t){w((e=l,{x:(n=t).x+e.x,y:n.y+e.y,w:n.w,h:n.h}));var e,n}return t('<div id="'+v+'" class="'+h+'croprect-container" role="grid" aria-dropeffect="execute">').appendTo(s),r.each(d,function(e){t("#"+v,s).append('<div id="'+v+"-"+e+'"class="'+h+'croprect-block" style="display: none" data-mce-bogus="all">')}),r.each(g,function(e){t("#"+v,s).append('<div id="'+v+"-"+e.name+'" class="'+h+"croprect-handle "+h+"croprect-handle-"+e.name+'"style="display: none" data-mce-bogus="all" role="gridcell" tabindex="-1" aria-label="'+e.label+'" aria-grabbed="false">')}),p=r.map(g,function(t){var e;return new(n.get("DragHelper"))(v,{document:s.ownerDocument,handle:v+"-"+t.name,start:function(){e=u},drag:function(n){b(t,e,n.deltaX,n.deltaY)}})}),x(u),t(s).on("focusin focusout",function(e){t(e.target).attr("aria-grabbed","focus"===e.type)}),t(s).on("keydown",function(t){var e;r.each(g,function(n){if(t.target.id===v+"-"+n.name)return e=n,!1});function n(t,n,o,r,i){t.stopPropagation(),t.preventDefault(),b(e,o,r,i)}switch(t.keyCode){case i.LEFT:n(t,0,u,-10,0);break;case i.RIGHT:n(t,0,u,10,0);break;case i.UP:n(t,0,u,0,-10);break;case i.DOWN:n(t,0,u,0,10);break;case i.ENTER:case i.SPACEBAR:t.preventDefault(),f()}}),m=r.extend({toggleVisibility:function(e){var n;n=r.map(g,function(t){return"#"+v+"-"+t.name}).concat(r.map(d,function(t){return"#"+v+"-"+t})).join(","),e?t(n,s).show():t(n,s).hide()},setClampRect:function(t){l=t,x(u)},setRect:w,getInnerRect:function(){return y(l,u)},setInnerRect:R,setViewPortRect:function(t){c=t,x(u)},destroy:function(){r.each(p,function(t){t.destroy()}),p=[]}},o)}}),o("tinymce.plugins.imagetools.ui.ImagePanel",["global!document","global!Image","tinymce.core.geom.Rect","tinymce.core.ui.Factory","tinymce.core.util.Promise","tinymce.core.util.Tools","tinymce.plugins.imagetools.core.LoadImage","tinymce.plugins.imagetools.ui.CropRect"],function(t,e,n,o,r,i,a,u){return{create:function(r){return new(o.get("Control").extend({Defaults:{classes:"imagepanel"},selection:function(t){return arguments.length?(this.state.set("rect",t),this):this.state.get("rect")},imageSize:function(){var t=this.state.get("viewRect");return{w:t.w,h:t.h}},toggleCropRect:function(t){this.state.set("cropEnabled",t)},imageSrc:function(o){var r=this,i=new e;i.src=o,a.loadImage(i).then(function(){var e,o,a=r.state.get("viewRect");if((o=r.$el.find("img"))[0])o.replaceWith(i);else{var u=t.createElement("div");u.className="mce-imagepanel-bg",r.getEl().appendChild(u),r.getEl().appendChild(i)}e={x:0,y:0,w:i.naturalWidth,h:i.naturalHeight},r.state.set("viewRect",e),r.state.set("rect",n.inflate(e,-20,-20)),a&&a.w===e.w&&a.h===e.h||r.zoomFit(),r.repaintImage(),r.fire("load")})},zoom:function(t){return arguments.length?(this.state.set("zoom",t),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var t,e,n,o,r,i;t=this.$el.find("img"),e=this.getEl().clientWidth,n=this.getEl().clientHeight,o=t[0].naturalWidth,r=t[0].naturalHeight,(i=Math.min((e-10)/o,(n-10)/r))>=1&&(i=1),this.zoom(i)},repaintImage:function(){var t,e,n,o,r,i,a,u,c,l,s;s=this.getEl(),c=this.zoom(),l=this.state.get("rect"),a=this.$el.find("img"),u=this.$el.find(".mce-imagepanel-bg"),r=s.offsetWidth,i=s.offsetHeight,n=a[0].naturalWidth*c,o=a[0].naturalHeight*c,t=Math.max(0,r/2-n/2),e=Math.max(0,i/2-o/2),a.css({left:t,top:e,width:n,height:o}),u.css({left:t,top:e,width:n,height:o}),this.cropRect&&(this.cropRect.setRect({x:l.x*c+t,y:l.y*c+e,w:l.w*c,h:l.h*c}),this.cropRect.setClampRect({x:t,y:e,w:n,h:o}),this.cropRect.setViewPortRect({x:0,y:0,w:r,h:i}))},bindStates:function(){var t=this;t.state.on("change:cropEnabled",function(e){t.cropRect.toggleVisibility(e.value),t.repaintImage()}),t.state.on("change:zoom",function(){t.repaintImage()}),t.state.on("change:rect",function(e){var n=e.value;t.cropRect||(o=n,t.cropRect=new u(o,t.state.get("viewRect"),t.state.get("viewRect"),t.getEl(),function(){t.fire("crop")}),t.cropRect.on("updateRect",function(e){var n=e.rect,o=t.zoom();n={x:Math.round(n.x/o),y:Math.round(n.y/o),w:Math.round(n.w/o),h:Math.round(n.h/o)},t.state.set("rect",n)}),t.on("remove",t.cropRect.destroy));var o;t.cropRect.setRect(n)})}}))(r)}}}),o("tinymce.plugins.imagetools.ui.Dialog",["ephox.imagetools.api.ImageTransformations","ephox.imagetools.api.ResultConversions","ephox.sand.api.URL","global!Math","global!setTimeout","tinymce.core.dom.DOMUtils","tinymce.core.ui.Factory","tinymce.core.util.Promise","tinymce.core.util.Tools","tinymce.plugins.imagetools.core.UndoStack","tinymce.plugins.imagetools.ui.ImagePanel"],function(t,e,n,o,r,i,a,u,c,l,s){function f(t){return{blob:t,url:n.createObjectURL(t)}}function m(t){t&&n.revokeObjectURL(t.url)}function g(t){c.each(t,m)}function p(n,u,p,d){var h,v,y,b,x,w,R,I,T,k,C,U,B,S,M,O,A,z,D,j,E,L,P,F,H,_,W,q=new l;function V(t){var e,n,r,i;e=h.find("#w")[0],n=h.find("#h")[0],r=parseInt(e.value(),10),i=parseInt(n.value(),10),h.find("#constrain")[0].checked()&&F&&H&&r&&i&&("w"===t.control.settings.name?(i=o.round(r*_),n.value(i)):(r=o.round(i*W),e.value(r))),F=r,H=i}function G(t){return o.round(100*t)+"%"}function N(){h.find("#undo").disabled(!q.canUndo()),h.find("#redo").disabled(!q.canRedo()),h.statusbar.find("#save").disabled(!q.canUndo())}function X(){h.find("#undo").disabled(!0),h.find("#redo").disabled(!0)}function $(t){t&&I.imageSrc(t.url)}function Y(t){return function(){var e=c.grep(P,function(e){return e.settings.name!==t});c.each(e,function(t){t.hide()}),t.show(),t.focus()}}function K(t){$(b=f(t))}function J(t){$(u=f(t)),g(q.add(u).removed),N()}function Q(){var n=I.selection();e.blobToImageResult(u.blob).then(function(e){t.crop(e,n.x,n.y,n.w,n.h).then(ot).then(function(t){J(t),tt()})})}function Z(t){var n=[].slice.call(arguments,1);return function(){var o=b||u;e.blobToImageResult(o.blob).then(function(e){t.apply(this,[e].concat(n)).then(ot).then(K)})}}function tt(){$(u),m(b),Y(v)(),N()}function et(){b?(J(b.blob),tt()):function t(e,o){b?o():r(function(){e-- >0?t(e,o):n.windowManager.alert("Error: failed to apply image operation.")},10)}(100,et)}function nt(t){return a.create("Form",{layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:t})}var ot=function(t){return t.toBlob()};function rt(t,n){return nt([{text:"Back",onclick:tt},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:et}]).hide().on("show",function(){X(),e.blobToImageResult(u.blob).then(function(t){return n(t)}).then(ot).then(function(t){var e=f(t);$(e),m(b),b=e})})}function it(t,n,o,r,i){return nt([{text:"Back",onclick:tt},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(t){o=t.value,e.blobToImageResult(u.blob).then(function(t){return n(t,o)}).then(ot).then(function(t){var e=f(t);$(e),m(b),b=e});var o},minValue:r,maxValue:i,value:o,previewFilter:G},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:et}]).hide().on("show",function(){this.find("slider").value(o),X()})}x=nt([{text:"Back",onclick:tt},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:Q}]).hide().on("show hide",function(t){I.toggleCropRect("show"===t.type)}).on("show",X);w=nt([{text:"Back",onclick:tt},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:V},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:V},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:function(t){!0===t.control.value()&&(_=H/F,W=F/H)}},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(n){var o=parseInt(h.find("#w").value(),10),r=parseInt(h.find("#h").value(),10);n.preventDefault(),function(t){var n=[].slice.call(arguments,1);return function(){e.blobToImageResult(u.blob).then(function(e){t.apply(this,[e].concat(n)).then(ot).then(J)})}}(t.resize,o,r)(),tt()}).on("show",X),R=nt([{text:"Back",onclick:tt},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:Z(t.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:Z(t.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:Z(t.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:Z(t.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:et}]).hide().on("show",X),C=rt(0,t.invert),D=rt(0,t.sharpen),j=rt(0,t.emboss),U=it(0,t.brightness,0,-1,1),B=it(0,t.hue,180,0,360),S=it(0,t.saturate,0,-1,1),M=it(0,t.contrast,0,-1,1),O=it(0,t.grayscale,0,0,1),A=it(0,t.sepia,0,0,1),z=function(t,n){function o(){var t,o,r;t=h.find("#r")[0].value(),o=h.find("#g")[0].value(),r=h.find("#b")[0].value(),e.blobToImageResult(u.blob).then(function(e){return n(e,t,o,r)}).then(ot).then(function(t){var e=f(t);$(e),m(b),b=e})}return nt([{text:"Back",onclick:tt},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:G},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:G},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:G},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:et}]).hide().on("show",function(){h.find("#r,#g,#b").value(1),X()})}(0,t.colorize),E=it(0,t.gamma,0,-1,1),L=it(0,t.exposure,1,0,2),y=nt([{text:"Back",onclick:tt},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:Y(B)},{text:"saturate",icon:"saturate",onclick:Y(S)},{text:"sepia",icon:"sepia",onclick:Y(A)},{text:"emboss",icon:"emboss",onclick:Y(j)},{text:"exposure",icon:"exposure",onclick:Y(L)},{type:"spacer",flex:1}]).hide(),v=nt([{tooltip:"Crop",icon:"crop",onclick:Y(x)},{tooltip:"Resize",icon:"resize2",onclick:Y(w)},{tooltip:"Orientation",icon:"orientation",onclick:Y(R)},{tooltip:"Brightness",icon:"sun",onclick:Y(U)},{tooltip:"Sharpen",icon:"sharpen",onclick:Y(D)},{tooltip:"Contrast",icon:"contrast",onclick:Y(M)},{tooltip:"Color levels",icon:"drop",onclick:Y(z)},{tooltip:"Gamma",icon:"gamma",onclick:Y(E)},{tooltip:"Invert",icon:"invert",onclick:Y(C)}]),I=s.create({flex:1,imageSrc:u.url}),T=a.create("Container",{layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:function(){$(u=q.undo()),N()}},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:function(){$(u=q.redo()),N()}},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:function(){var t=I.zoom();t<2&&(t+=.1),I.zoom(t)}},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:function(){var t=I.zoom();t>.1&&(t-=.1),I.zoom(t)}}]}),k=a.create("Container",{type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[T,I]}),P=[v,x,w,R,y,C,U,B,S,M,O,A,z,D,j,E,L],(h=n.windowManager.open({layout:"flex",direction:"column",align:"stretch",minWidth:o.min(i.DOM.getViewPort().w,800),minHeight:o.min(i.DOM.getViewPort().h,650),title:"Edit image",items:P.concat([k]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:function(){p(u.blob),h.close()}},{text:"Cancel",onclick:"close"}]})).on("close",function(){d(),g(q.data),q=null,b=null}),q.add(u),N(),I.on("load",function(){F=I.imageSize().w,H=I.imageSize().h,_=H/F,W=F/H,h.find("#w").value(F),h.find("#h").value(H)}),I.on("crop",Q)}return{edit:function(t,e){return new u(function(n,o){return e.toBlob().then(function(e){p(t,f(e),n,o)})})}}}),o("tinymce.plugins.imagetools.core.Actions",["ephox.imagetools.api.BlobConversions","ephox.imagetools.api.ImageTransformations","ephox.imagetools.api.ResultConversions","ephox.katamari.api.Fun","ephox.sand.api.URL","global!clearTimeout","tinymce.core.util.Delay","tinymce.core.util.Promise","tinymce.core.util.Tools","tinymce.core.util.URI","tinymce.plugins.imagetools.api.Settings","tinymce.plugins.imagetools.core.ImageSize","tinymce.plugins.imagetools.core.Proxy","tinymce.plugins.imagetools.ui.Dialog"],function(t,e,n,o,r,i,a,u,c,l,s,f,m,g){var p=0,d=function(t,e){t.notificationManager.open({text:e,type:"error"})},h=function(t){return t.selection.getNode()},v=function(t,e){var n=e.src;return 0===n.indexOf("data:")||0===n.indexOf("blob:")||new l(n).host===t.documentBaseURI.host},y=function(t,e){return-1!==c.inArray(t.settings.imagetools_cors_hosts,new l(e.src).host)},b=function(e){var n;return(n=e.editorUpload.blobCache.getByUri(h(e).src))?u.resolve(n.blob()):function(e,n){var o,r=n.src;if(y(e,n))return m.getUrl(n.src,null);if(!v(e,n))return r=s.getProxyUrl(e),r+=(-1===r.indexOf("?")?"?":"&")+"url="+encodeURIComponent(n.src),o=(i=e).settings.api_key||i.settings.imagetools_api_key,m.getUrl(r,o);var i;return t.imageToBlob(n)}(e,h(e))},x=function(t,e){var n=a.setEditorTimeout(t,function(){t.editorUpload.uploadImagesAuto()},t.settings.images_upload_timeout||3e4);e.set(n)},w=function(t){i(t.get())},R=function(t,e,n,o){return e.toBlob().then(function(r){var i,a,u,c,l;return u=t.editorUpload.blobCache,i=(l=h(t)).src,t.settings.images_reuse_filename&&((c=u.getByUri(i))?(i=c.uri(),a=c.name()):a=function(t,e){var n=e.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return n?t.dom.encode(n[1]):null}(t,i)),c=u.create({id:"imagetools"+p++,blob:r,base64:e.toBase64(),uri:i,name:a}),u.add(c),t.undoManager.transact(function(){t.$(l).on("load",function e(){t.$(l).off("load",e),t.nodeChanged(),n?t.editorUpload.uploadImagesAuto():(w(o),x(t,o))}),t.$(l).attr({src:c.blobUri()}).removeAttr("data-mce-src")}),c})},I=function(t,e,r){return function(){return t._scanForImages().then(o.curry(b,t)).then(n.blobToImageResult).then(r).then(function(n){return R(t,n,!1,e)},function(e){d(t,e)})}};return{rotate:function(t,n,o){return function(){return I(t,n,function(n){var r=f.getImageSize(h(t));return r&&f.setImageSize(h(t),{w:r.h,h:r.w}),e.rotate(n,o)})()}},flip:function(t,n,o){return function(){return I(t,n,function(t){return e.flip(t,o)})()}},editImageDialog:function(e,i){return function(){var a=h(e),c=f.getNaturalImageSize(a),l=function(e){return new u(function(n){t.blobToImage(e).then(function(t){var o=f.getNaturalImageSize(t);c.w===o.w&&c.h===o.h||f.getImageSize(a)&&f.setImageSize(a,o),r.revokeObjectURL(t.src),n(e)})})};b(e).then(n.blobToImageResult).then(o.curry(function(t,e){return g.edit(t,e).then(l).then(n.blobToImageResult).then(function(e){return R(t,e,!0,i)},function(){})},e),function(t){d(e,t)})}},isEditableImage:function(t,e){return t.dom.is(e,"img:not([data-mce-object],[data-mce-placeholder])")&&(v(t,e)||y(t,e)||t.settings.imagetools_proxy)},cancelTimedUpload:w}}),o("tinymce.plugins.imagetools.api.Commands",["tinymce.core.util.Tools","tinymce.plugins.imagetools.core.Actions"],function(t,e){return{register:function(n,o){t.each({mceImageRotateLeft:e.rotate(n,o,-90),mceImageRotateRight:e.rotate(n,o,90),mceImageFlipVertical:e.flip(n,o,"v"),mceImageFlipHorizontal:e.flip(n,o,"h"),mceEditImage:e.editImageDialog(n,o)},function(t,e){n.addCommand(e,t)})}}}),o("tinymce.plugins.imagetools.core.UploadSelectedImage",["tinymce.plugins.imagetools.core.Actions"],function(t){return{setup:function(e,n,o){e.on("NodeChange",function(r){var i=o.get();i&&i.src!==r.element.src&&(t.cancelTimedUpload(n),e.editorUpload.uploadImagesAuto(),o.set(null)),t.isEditableImage(e,r.element)&&o.set(r.element)})}}}),o("tinymce.plugins.imagetools.ui.Buttons",[],function(){return{register:function(t){t.addButton("rotateleft",{title:"Rotate counterclockwise",cmd:"mceImageRotateLeft"}),t.addButton("rotateright",{title:"Rotate clockwise",cmd:"mceImageRotateRight"}),t.addButton("flipv",{title:"Flip vertically",cmd:"mceImageFlipVertical"}),t.addButton("fliph",{title:"Flip horizontally",cmd:"mceImageFlipHorizontal"}),t.addButton("editimage",{title:"Edit image",cmd:"mceEditImage"}),t.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}}}),o("tinymce.plugins.imagetools.ui.ContextToolbar",["ephox.katamari.api.Fun","tinymce.plugins.imagetools.api.Settings","tinymce.plugins.imagetools.core.Actions"],function(t,e,n){return{register:function(o){o.addContextToolbar(t.curry(n.isEditableImage,o),e.getToolbarItems(o))}}}),o("tinymce.plugins.imagetools.Plugin",["ephox.katamari.api.Cell","tinymce.core.PluginManager","tinymce.plugins.imagetools.api.Commands","tinymce.plugins.imagetools.core.UploadSelectedImage","tinymce.plugins.imagetools.ui.Buttons","tinymce.plugins.imagetools.ui.ContextToolbar"],function(t,e,n,o,r,i){return e.add("imagetools",function(e){var a=t(0),u=t(null);n.register(e,a),r.register(e),i.register(e),o.setup(e,a,u)}),function(){}}),n("tinymce.plugins.imagetools.Plugin")()}();