!function(){var t={},e=function(e,n,r){if("string"!=typeof e)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+e;if(void 0===r)throw"no definition function for "+e;t[e]={deps:n,defn:r,instance:void 0}},n=function(e){var r=t[e];if(void 0===r)throw"module ["+e+"] was undefined";return void 0===r.instance&&function(e){for(var r=t[e],a=r.deps,i=r.defn,o=a.length,l=new Array(o),c=0;c<o;++c)l[c]=n(a[c]);var u=i.apply(null,l);if(void 0===u)throw"module ["+e+"] returned undefined";r.instance=u}(e),r.instance},r=e,a=function(t,e){r(t,[],function(){return e})};r("ephox.katamari.api.Cell",[],function(){var t=function(e){var n=e,r=function(){return n};return{get:r,set:function(t){n=t},clone:function(){return t(r())}}};return t}),a("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve),r("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.PluginManager")}),r("tinymce.plugins.textpattern.api.Api",[],function(){return{get:function(t){return{setPatterns:function(e){t.set(e)},getPatterns:function(){return t.get()}}}}}),r("tinymce.plugins.textpattern.api.Settings",[],function(){var t=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"***",end:"***",format:["bold","italic"]},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}];return{getPatterns:function(e){return void 0!==e.textpattern_patterns?e.textpattern_patterns:t}}}),r("tinymce.core.util.Delay",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.Delay")}),r("tinymce.core.util.VK",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.VK")}),a("global!document",document),r("tinymce.core.dom.TreeWalker",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.dom.TreeWalker")}),r("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(t){return t("tinymce.util.Tools")}),r("tinymce.plugins.textpattern.core.Patterns",[],function(){return{findPattern:function(t,e){for(var n=0;n<t.length;n++)if(0===e.indexOf(t[n].start)&&(!t[n].end||e.lastIndexOf(t[n].end)===e.length-t[n].end.length))return t[n]},findEndPattern:function(t,e,n,r){var a,i,o,l=(o=t,o.sort(function(t,e){return t.start.length>e.start.length?-1:t.start.length<e.start.length?1:0}));for(i=0;i<l.length;i++)if(void 0!==(a=l[i]).end&&(f=a,d=e,g=n,m=r,d.substr(g-f.end.length-m,f.end.length)===f.end)&&(c=n,u=r,s=a,c-u-s.end.length-s.start.length>0))return a;var c,u,s,f,d,g,m}}}),r("tinymce.plugins.textpattern.core.Formatter",["global!document","tinymce.core.dom.TreeWalker","tinymce.core.util.Tools","tinymce.plugins.textpattern.core.Patterns"],function(t,e,n,r){var a=function(e,n,a){if(!1!==n.collapsed){var i=n.startContainer,o=i.data,l=!0===a?1:0;if(3===i.nodeType){var c=r.findEndPattern(e,o,n.startOffset,l);if(void 0!==c){var u=o.lastIndexOf(c.end,n.startOffset-l),s=o.lastIndexOf(c.start,u-c.end.length);if(u=o.indexOf(c.end,s+c.start.length),-1!==s){var f=t.createRange();f.setStart(i,s),f.setEnd(i,u+c.end.length);var d=r.findPattern(e,f.toString());if(!(void 0===c||d!==c||i.data.length<=c.start.length+c.end.length))return{pattern:c,startOffset:s,endOffset:u}}}}}},i=function(t,e,r){var i=t.selection.getRng(!0),o=a(e,i,r);if(o)return function(t,e,r,a){var i=n.isArray(r.pattern.format)?r.pattern.format:[r.pattern.format];if(0!==n.grep(i,function(e){var n=t.formatter.get(e);return n&&n[0].inline}).length)return t.undoManager.transact(function(){n=e,a=r.pattern,o=r.endOffset,l=r.startOffset,(n=l>0?n.splitText(l):n).splitText(o-l+a.end.length),n.deleteData(0,a.start.length),n.deleteData(n.data.length-a.end.length,a.end.length),e=n;var n,a,o,l;i.forEach(function(n){t.formatter.apply(n,{},e)})}),e}(t,i.startContainer,o)};return{patternFromRng:a,applyInlineFormatSpace:function(t,e){return i(t,e,!0)},applyInlineFormatEnter:function(t,e){return i(t,e,!1)},applyBlockFormat:function(t,a){var i,o,l,c,u,s,f,d,g,m,p;if(i=t.selection,o=t.dom,i.isCollapsed()&&(f=o.getParent(i.getStart(),"p"))){for(g=new e(f,f);u=g.next();)if(3===u.nodeType){c=u;break}if(c){if(!(d=r.findPattern(a,c.data)))return;if(l=(m=i.getRng(!0)).startContainer,p=m.startOffset,c===l&&(p=Math.max(0,p-d.start.length)),n.trim(c.data).length===d.start.length)return;d.format&&(s=t.formatter.get(d.format))&&s[0].block&&(c.deleteData(0,d.start.length),t.formatter.apply(d.format,{},c),m.setStart(l,p),m.collapse(!0),i.setRng(m)),d.cmd&&t.undoManager.transact(function(){c.deleteData(0,d.start.length),t.execCommand(d.cmd)})}}}}}),r("tinymce.plugins.textpattern.core.KeyHandler",["tinymce.core.util.VK","tinymce.plugins.textpattern.core.Formatter"],function(t,e){var n=function(t,e,n){for(var r=0;r<t.length;r++)if(n(t[r],e))return!0};return{handleEnter:function(t,n){var r,a;(r=e.applyInlineFormatEnter(t,n))&&((a=t.dom.createRng()).setStart(r,r.data.length),a.setEnd(r,r.data.length),t.selection.setRng(a)),e.applyBlockFormat(t,n)},handleInlineKey:function(t,n){var r,a,i,o,l;(r=e.applyInlineFormatSpace(t,n))&&(l=t.dom,a=r.data.slice(-1),/[\u00a0 ]/.test(a)&&(r.deleteData(r.data.length-1,1),i=l.doc.createTextNode(a),l.insertAfter(i,r.parentNode),(o=l.createRng()).setStart(i,1),o.setEnd(i,1),t.selection.setRng(o)))},checkCharCode:function(t,e){return n(t,e,function(t,e){return t.charCodeAt(0)===e.charCode})},checkKeyCode:function(e,r){return n(e,r,function(e,n){return e===n.keyCode&&!1===t.modifierPressed(n)})}}}),r("tinymce.plugins.textpattern.core.Keyboard",["tinymce.core.util.Delay","tinymce.core.util.VK","tinymce.plugins.textpattern.core.KeyHandler"],function(t,e,n){return{setup:function(r,a){var i=[",",".",";",":","!","?"],o=[32];r.on("keydown",function(t){13!==t.keyCode||e.modifierPressed(t)||n.handleEnter(r,a.get())},!0),r.on("keyup",function(t){n.checkKeyCode(o,t)&&n.handleInlineKey(r,a.get())}),r.on("keypress",function(e){n.checkCharCode(i,e)&&t.setEditorTimeout(r,function(){n.handleInlineKey(r,a.get())})})}}}),r("tinymce.plugins.textpattern.Plugin",["ephox.katamari.api.Cell","tinymce.core.PluginManager","tinymce.plugins.textpattern.api.Api","tinymce.plugins.textpattern.api.Settings","tinymce.plugins.textpattern.core.Keyboard"],function(t,e,n,r,a){return e.add("textpattern",function(e){var i=t(r.getPatterns(e.settings));return a.setup(e,i),n.get(i)}),function(){}}),n("tinymce.plugins.textpattern.Plugin")()}();