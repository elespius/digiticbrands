!function(){var e={},t=function(t,n,r){if("string"!=typeof t)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+t;if(void 0===r)throw"no definition function for "+t;e[t]={deps:n,defn:r,instance:void 0}},n=function(t){var r=e[t];if(void 0===r)throw"module ["+t+"] was undefined";return void 0===r.instance&&function(t){for(var r=e[t],o=r.deps,a=r.defn,i=o.length,u=new Array(i),s=0;s<i;++s)u[s]=n(o[s]);var c=a.apply(null,u);if(void 0===c)throw"module ["+t+"] returned undefined";r.instance=c}(t),r.instance},r=t,o=function(e,t){r(e,[],function(){return t})};r("ephox.katamari.api.Cell",[],function(){var e=function(t){var n=t,r=function(){return n};return{get:r,set:function(e){n=e},clone:function(){return e(r())}}};return e}),o("global!tinymce.util.Tools.resolve",tinymce.util.Tools.resolve),r("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.PluginManager")}),o("global!setInterval",setInterval),r("tinymce.core.util.LocalStorage",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.LocalStorage")}),r("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.Tools")}),r("tinymce.plugins.autosave.api.Events",[],function(){return{fireRestoreDraft:function(e){return e.fire("RestoreDraft")},fireStoreDraft:function(e){return e.fire("StoreDraft")},fireRemoveDraft:function(e){return e.fire("RemoveDraft")}}}),o("global!document",document),r("tinymce.plugins.autosave.core.Time",[],function(){return{parse:function(e,t){return((e=/^(\d+)([ms]?)$/.exec(""+(e||t)))[2]?{s:1e3,m:6e4}[e[2]]:1)*parseInt(e,10)}}}),r("tinymce.plugins.autosave.api.Settings",["global!document","tinymce.plugins.autosave.core.Time"],function(e,t){return{shouldAskBeforeUnload:function(e){return e.getParam("autosave_ask_before_unload",!0)},getAutoSavePrefix:function(t){var n=t.getParam("autosave_prefix","tinymce-autosave-{path}{query}{hash}-{id}-");return n=(n=(n=(n=n.replace(/\{path\}/g,e.location.pathname)).replace(/\{query\}/g,e.location.search)).replace(/\{hash\}/g,e.location.hash)).replace(/\{id\}/g,t.id)},shouldRestoreWhenEmpty:function(e){return e.getParam("autosave_restore_when_empty",!1)},getAutoSaveInterval:function(e){return t.parse(e.settings.autosave_interval,"30s")},getAutoSaveRetention:function(e){return t.parse(e.settings.autosave_retention,"20m")}}}),r("tinymce.plugins.autosave.core.Storage",["global!setInterval","tinymce.core.util.LocalStorage","tinymce.core.util.Tools","tinymce.plugins.autosave.api.Events","tinymce.plugins.autosave.api.Settings"],function(e,t,n,r,o){var a=function(e,t){var r=e.settings.forced_root_block;return""===(t=n.trim(void 0===t?e.getBody().innerHTML:t))||new RegExp("^<"+r+"[^>]*>((Â |&nbsp;|[ \t]|<br[^>]*>)+?|)</"+r+">|<br>$","i").test(t)},i=function(e){var n=parseInt(t.getItem(o.getAutoSavePrefix(e)+"time"),10)||0;return!((new Date).getTime()-n>o.getAutoSaveRetention(e))||(u(e,!1),!1)},u=function(e,n){var a=o.getAutoSavePrefix(e);t.removeItem(a+"draft"),t.removeItem(a+"time"),!1!==n&&r.fireRemoveDraft(e)},s=function(e){var n=o.getAutoSavePrefix(e);!a(e)&&e.isDirty()&&(t.setItem(n+"draft",e.getContent({format:"raw",no_events:!0})),t.setItem(n+"time",(new Date).getTime()),r.fireStoreDraft(e))},c=function(e){var n=o.getAutoSavePrefix(e);i(e)&&(e.setContent(t.getItem(n+"draft"),{format:"raw"}),r.fireRestoreDraft(e))};return{isEmpty:a,hasDraft:i,removeDraft:u,storeDraft:s,restoreDraft:c,startStoreDraft:function(t,n){var r=o.getAutoSaveInterval(t);n.get()||(e(function(){t.removed||s(t)},r),n.set(!0))},restoreLastDraft:function(e){e.undoManager.transact(function(){c(e),u(e)}),e.focus()}}}),r("tinymce.plugins.autosave.api.Api",["tinymce.plugins.autosave.core.Storage"],function(e){var t=function(e,t){return function(){var n=Array.prototype.slice.call(arguments);return e.apply(null,[t].concat(n))}};return{get:function(n){return{hasDraft:t(e.hasDraft,n),storeDraft:t(e.storeDraft,n),restoreDraft:t(e.restoreDraft,n),removeDraft:t(e.removeDraft,n),isEmpty:t(e.isEmpty,n)}}}}),o("global!window",window),r("tinymce.core.EditorManager",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.EditorManager")}),r("tinymce.plugins.autosave.core.BeforeUnload",["global!window","tinymce.core.EditorManager","tinymce.core.util.Tools","tinymce.plugins.autosave.api.Settings"],function(e,t,n,r){t._beforeUnloadHandler=function(){var e;return n.each(t.get(),function(t){t.plugins.autosave&&t.plugins.autosave.storeDraft(),!e&&t.isDirty()&&r.shouldAskBeforeUnload(t)&&(e=t.translate("You have unsaved changes are you sure you want to navigate away?"))}),e};return{setup:function(n){e.onbeforeunload=t._beforeUnloadHandler}}}),r("tinymce.plugins.autosave.ui.Buttons",["tinymce.plugins.autosave.core.Storage"],function(e){var t=function(t,n){return function(r){var o=r.control;o.disabled(!e.hasDraft(t)),t.on("StoreDraft RestoreDraft RemoveDraft",function(){o.disabled(!e.hasDraft(t))}),e.startStoreDraft(t,n)}};return{register:function(n,r){n.addButton("restoredraft",{title:"Restore last draft",onclick:function(){e.restoreLastDraft(n)},onPostRender:t(n,r)}),n.addMenuItem("restoredraft",{text:"Restore last draft",onclick:function(){e.restoreLastDraft(n)},onPostRender:t(n,r),context:"file"})}}}),r("tinymce.plugins.autosave.Plugin",["ephox.katamari.api.Cell","tinymce.core.PluginManager","tinymce.plugins.autosave.api.Api","tinymce.plugins.autosave.core.BeforeUnload","tinymce.plugins.autosave.ui.Buttons"],function(e,t,n,r,o){return t.add("autosave",function(t){var a=e(!1);return r.setup(t),o.register(t,a),n.get(t)}),function(){}}),n("tinymce.plugins.autosave.Plugin")()}();