!function(){var e={},t=function(t,n,l){if("string"!=typeof t)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+t;if(void 0===l)throw"no definition function for "+t;e[t]={deps:n,defn:l,instance:void 0}},n=function(t){var l=e[t];if(void 0===l)throw"module ["+t+"] was undefined";return void 0===l.instance&&function(t){for(var l=e[t],i=l.deps,o=l.defn,r=i.length,a=new Array(r),u=0;u<r;++u)a[u]=n(i[u]);var c=o.apply(null,a);if(void 0===c)throw"module ["+t+"] returned undefined";l.instance=c}(t),l.instance},l=t;l("ephox.katamari.api.Cell",[],function(){var e=function(t){var n=t,l=function(){return n};return{get:l,set:function(e){n=e},clone:function(){return e(l())}}};return e}),i="global!tinymce.util.Tools.resolve",o=tinymce.util.Tools.resolve,l(i,[],function(){return o});var i,o;l("tinymce.core.PluginManager",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.PluginManager")}),l("tinymce.core.util.Tools",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.util.Tools")}),l("tinymce.core.html.DomParser",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.html.DomParser")}),l("tinymce.core.html.Node",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.html.Node")}),l("tinymce.core.html.Serializer",["global!tinymce.util.Tools.resolve"],function(e){return e("tinymce.html.Serializer")}),l("tinymce.plugins.fullpage.api.Settings",[],function(){return{shouldHideInSourceView:function(e){return e.getParam("fullpage_hide_in_source_view")},getDefaultXmlPi:function(e){return e.getParam("fullpage_default_xml_pi")},getDefaultEncoding:function(e){return e.getParam("fullpage_default_encoding")},getDefaultFontFamily:function(e){return e.getParam("fullpage_default_font_family")},getDefaultFontSize:function(e){return e.getParam("fullpage_default_font_size")},getDefaultTextColor:function(e){return e.getParam("fullpage_default_text_color")},getDefaultTitle:function(e){return e.getParam("fullpage_default_title")},getDefaultDocType:function(e){return e.getParam("fullpage_default_doctype","<!DOCTYPE html>")}}}),l("tinymce.plugins.fullpage.core.Parser",["tinymce.core.html.DomParser","tinymce.core.html.Node","tinymce.core.html.Serializer","tinymce.core.util.Tools","tinymce.plugins.fullpage.api.Settings"],function(e,t,n,l,i){var o=function(t){return new e({validate:!1,root_name:"#document"}).parse(t)};return{parseHeader:o,htmlToData:function(e,t){var n,r,a=o(t),u={};function c(e,t){return e.attr(t)||""}return u.fontface=i.getDefaultFontFamily(e),u.fontsize=i.getDefaultFontSize(e),7===(n=a.firstChild).type&&(u.xml_pi=!0,(r=/encoding="([^"]+)"/.exec(n.value))&&(u.docencoding=r[1])),(n=a.getAll("#doctype")[0])&&(u.doctype="<!DOCTYPE"+n.value+">"),(n=a.getAll("title")[0])&&n.firstChild&&(u.title=n.firstChild.value),l.each(a.getAll("meta"),function(e){var t,n=e.attr("name"),l=e.attr("http-equiv");n?u[n.toLowerCase()]=e.attr("content"):"Content-Type"===l&&(t=/charset\s*=\s*(.*)\s*/gi.exec(e.attr("content")))&&(u.docencoding=t[1])}),(n=a.getAll("html")[0])&&(u.langcode=c(n,"lang")||c(n,"xml:lang")),u.stylesheets=[],l.each(a.getAll("link"),function(e){"stylesheet"===e.attr("rel")&&u.stylesheets.push(e.attr("href"))}),(n=a.getAll("body")[0])&&(u.langdir=c(n,"dir"),u.style=c(n,"style"),u.visited_color=c(n,"vlink"),u.link_color=c(n,"link"),u.active_color=c(n,"alink")),u},dataToHtml:function(e,i,r){var a,u,c,s,f,g=e.dom;function d(e,t,n){e.attr(t,n||void 0)}function m(e){u.firstChild?u.insert(e,u.firstChild):u.append(e)}a=o(r),(u=a.getAll("head")[0])||(s=a.getAll("html")[0],u=new t("head",1),s.firstChild?s.insert(u,s.firstChild,!0):s.append(u)),s=a.firstChild,i.xml_pi?(f='version="1.0"',i.docencoding&&(f+=' encoding="'+i.docencoding+'"'),7!==s.type&&(s=new t("xml",7),a.insert(s,a.firstChild,!0)),s.value=f):s&&7===s.type&&s.remove(),s=a.getAll("#doctype")[0],i.doctype?(s||(s=new t("#doctype",10),i.xml_pi?a.insert(s,a.firstChild):m(s)),s.value=i.doctype.substring(9,i.doctype.length-1)):s&&s.remove(),s=null,l.each(a.getAll("meta"),function(e){"Content-Type"===e.attr("http-equiv")&&(s=e)}),i.docencoding?(s||((s=new t("meta",1)).attr("http-equiv","Content-Type"),s.shortEnded=!0,m(s)),s.attr("content","text/html; charset="+i.docencoding)):s&&s.remove(),s=a.getAll("title")[0],i.title?(s?s.empty():m(s=new t("title",1)),s.append(new t("#text",3)).value=i.title):s&&s.remove(),l.each("keywords,description,author,copyright,robots".split(","),function(e){var n,l,o=a.getAll("meta"),r=i[e];for(n=0;n<o.length;n++)if((l=o[n]).attr("name")===e)return void(r?l.attr("content",r):l.remove());r&&((s=new t("meta",1)).attr("name",e),s.attr("content",r),s.shortEnded=!0,m(s))});var p={};return l.each(a.getAll("link"),function(e){"stylesheet"===e.attr("rel")&&(p[e.attr("href")]=e)}),l.each(i.stylesheets,function(e){p[e]||((s=new t("link",1)).attr({rel:"stylesheet",text:"text/css",href:e}),s.shortEnded=!0,m(s)),delete p[e]}),l.each(p,function(e){e.remove()}),(s=a.getAll("body")[0])&&(d(s,"dir",i.langdir),d(s,"style",i.style),d(s,"vlink",i.visited_color),d(s,"link",i.link_color),d(s,"alink",i.active_color),g.setAttribs(e.getBody(),{style:i.style,dir:i.dir,vLink:i.visited_color,link:i.link_color,aLink:i.active_color})),(s=a.getAll("html")[0])&&(d(s,"lang",i.langcode),d(s,"xml:lang",i.langcode)),u.firstChild||u.remove(),(c=new n({validate:!1,indent:!0,apply_source_formatting:!0,indent_before:"head,html,body,meta,title,script,link,style",indent_after:"head,html,body,meta,title,script,link,style"}).serialize(a)).substring(0,c.indexOf("</body>"))}}}),l("tinymce.plugins.fullpage.ui.Dialog",["tinymce.core.util.Tools","tinymce.plugins.fullpage.core.Parser"],function(e,t){return{open:function(n,l){var i=t.htmlToData(n,l.get());n.windowManager.open({title:"Document properties",data:i,defaults:{type:"textbox",size:40},body:[{name:"title",label:"Title"},{name:"keywords",label:"Keywords"},{name:"description",label:"Description"},{name:"robots",label:"Robots"},{name:"author",label:"Author"},{name:"docencoding",label:"Encoding"}],onSubmit:function(o){var r=t.dataToHtml(n,e.extend(i,o.data),l.get());l.set(r)}})}}}),l("tinymce.plugins.fullpage.api.Commands",["tinymce.plugins.fullpage.ui.Dialog"],function(e){return{register:function(t,n){t.addCommand("mceFullPageProperties",function(){e.open(t,n)})}}}),l("tinymce.plugins.fullpage.core.Protect",["tinymce.core.util.Tools"],function(e){return{protectHtml:function(t,n){return e.each(t,function(e){n=n.replace(e,function(e){return"\x3c!--mce:protected "+escape(e)+"--\x3e"})}),n},unprotectHtml:function(e){return e.replace(/<!--mce:protected ([\s\S]*?)-->/g,function(e,t){return unescape(t)})}}}),l("tinymce.plugins.fullpage.core.FilterContent",["tinymce.core.util.Tools","tinymce.plugins.fullpage.api.Settings","tinymce.plugins.fullpage.core.Parser","tinymce.plugins.fullpage.core.Protect"],function(e,t,n,l){var i=e.each,o=function(e){return e.replace(/<\/?[A-Z]+/g,function(e){return e.toLowerCase()})},r=function(e){var n,l="",i="";if(t.getDefaultXmlPi(e)){var o=t.getDefaultEncoding(e);l+='<?xml version="1.0" encoding="'+(o||"ISO-8859-1")+'" ?>\n'}return l+=t.getDefaultDocType(e),l+="\n<html>\n<head>\n",(n=t.getDefaultTitle(e))&&(l+="<title>"+n+"</title>\n"),(n=t.getDefaultEncoding(e))&&(l+='<meta http-equiv="Content-Type" content="text/html; charset='+n+'" />\n'),(n=t.getDefaultFontFamily(e))&&(i+="font-family: "+n+";"),(n=t.getDefaultFontSize(e))&&(i+="font-size: "+n+";"),(n=t.getDefaultTextColor(e))&&(i+="color: "+n+";"),l+="</head>\n<body"+(i?' style="'+i+'"':"")+">\n"};return{setup:function(a,u,c){a.on("BeforeSetContent",function(s){!function(a,u,c,s){var f,g,d,m,p,y="",h=a.dom;if(!(s.selection||(d=l.protectHtml(a.settings.protect,s.content),"raw"===s.format&&u.get()||s.source_view&&t.shouldHideInSourceView(a)))){0!==d.length||s.source_view||(d=e.trim(u.get())+"\n"+e.trim(d)+"\n"+e.trim(c.get())),-1!==(f=(d=d.replace(/<(\/?)BODY/gi,"<$1body")).indexOf("<body"))?(f=d.indexOf(">",f),u.set(o(d.substring(0,f+1))),-1===(g=d.indexOf("</body",f))&&(g=d.length),s.content=e.trim(d.substring(f+1,g)),c.set(o(d.substring(g)))):(u.set(r(a)),c.set("\n</body>\n</html>")),m=n.parseHeader(u.get()),i(m.getAll("style"),function(e){e.firstChild&&(y+=e.firstChild.value)}),(p=m.getAll("body")[0])&&h.setAttribs(a.getBody(),{style:p.attr("style")||"",dir:p.attr("dir")||"",vLink:p.attr("vlink")||"",link:p.attr("link")||"",aLink:p.attr("alink")||""}),h.remove("fullpage_styles");var v=a.getDoc().getElementsByTagName("head")[0];y&&(h.add(v,"style",{id:"fullpage_styles"},y),(p=h.get("fullpage_styles")).styleSheet&&(p.styleSheet.cssText=y));var _={};e.each(v.getElementsByTagName("link"),function(e){"stylesheet"===e.rel&&e.getAttribute("data-mce-fullpage")&&(_[e.href]=e)}),e.each(m.getAll("link"),function(e){var t=e.attr("href");if(!t)return!0;_[t]||"stylesheet"!==e.attr("rel")||h.add(v,"link",{rel:"stylesheet",text:"text/css",href:t,"data-mce-fullpage":"1"}),delete _[t]}),e.each(_,function(e){e.parentNode.removeChild(e)})}}(a,u,c,s)}),a.on("GetContent",function(n){i=a,o=u.get(),r=c.get(),(s=n).selection||s.source_view&&t.shouldHideInSourceView(i)||(s.content=l.unprotectHtml(e.trim(o)+"\n"+e.trim(s.content)+"\n"+e.trim(r)));var i,o,r,s})}}}),l("tinymce.plugins.fullpage.ui.Buttons",[],function(){return{register:function(e){e.addButton("fullpage",{title:"Document properties",cmd:"mceFullPageProperties"}),e.addMenuItem("fullpage",{text:"Document properties",cmd:"mceFullPageProperties",context:"file"})}}}),l("tinymce.plugins.fullpage.Plugin",["ephox.katamari.api.Cell","tinymce.core.PluginManager","tinymce.plugins.fullpage.api.Commands","tinymce.plugins.fullpage.core.FilterContent","tinymce.plugins.fullpage.ui.Buttons"],function(e,t,n,l,i){return t.add("fullpage",function(t){var o=e(""),r=e("");n.register(t,o),i.register(t),l.setup(t,o,r)}),function(){}}),n("tinymce.plugins.fullpage.Plugin")()}();