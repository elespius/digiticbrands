!function(t,i,e){function s(i,e){this.element=i,this.options=t.extend({},r,e),this._defaults=r,this.theForm=t(this.options.formSelector),this.filterButton=t(this.options.formSelector+" "+this.options.filterBtnSelector),this.filterContainer=t(this.options.formSelector+" "+this.options.filterContainerSelector),this.filtersHidden=this.options.filtersHidden,this.listButton=t(this.options.formSelector+" "+this.options.listBtnSelector),this.listContainer=t(this.options.formSelector+" "+this.options.listContainerSelector),this.listHidden=this.options.listHidden,this.mainContainer=t(this.options.mainContainerSelector),this.searchButton=t(this.options.formSelector+" "+this.options.searchBtnSelector),this.searchField=t(this.options.formSelector+" "+this.options.searchFieldSelector),this.searchString=null,this.clearButton=t(this.options.clearBtnSelector),this.orderCols=t(this.options.formSelector+" "+this.options.orderColumnSelector),this.orderField=t(this.options.formSelector+" "+this.options.orderFieldSelector),this.limitField=t(this.options.formSelector+" "+this.options.limitFieldSelector),this.activeColumn=null,this.activeDirection=this.options.activeDirection,this.activeOrder=this.options.activeOrder,this.activeLimit=null,this.chosenSupport=this.options.chosenSupport,this.clearListOptions=this.options.clearListOptions,this._name=o,this.init()}var o="searchtools",r={formSelector:".js-stools-form",searchFieldSelector:".js-stools-field-search",clearBtnSelector:".js-stools-btn-clear",mainContainerSelector:".js-stools",searchBtnSelector:".js-stools-btn-search",filterBtnSelector:".js-stools-btn-filter",filterContainerSelector:".js-stools-container-filters",filtersHidden:!0,listBtnSelector:".js-stools-btn-list",listContainerSelector:".js-stools-container-list",listHidden:!1,orderColumnSelector:".js-stools-column-order",orderBtnSelector:".js-stools-btn-order",orderFieldSelector:".js-stools-field-order",orderFieldName:"list[fullordering]",limitFieldSelector:".js-stools-field-limit",defaultLimit:20,activeOrder:null,activeDirection:"ASC",chosenSupport:!0,clearListOptions:!1};s.prototype={init:function(){var i=this;e.addEventListener||this.searchField.val()===this.searchField.attr("placeholder")&&this.searchField.val(""),this.searchString=this.searchField.val(),this.filtersHidden?this.hideFilters():this.showFilters(),this.listHidden?this.hideList():this.showList(),i.filterButton.click(function(t){i.toggleFilters(),t.stopPropagation(),t.preventDefault()}),i.listButton.click(function(t){i.toggleList(),t.stopPropagation(),t.preventDefault()}),i.getFilterFields().each(function(e,s){i.checkFilter(s),t(s).change(function(){i.checkFilter(s)})}),i.clearButton.click(function(){i.clear()}),this.createOrderField(),this.orderCols.click(function(){var e=t(this).attr("data-order"),s=t(this).attr("data-direction"),o=e+" "+s;e.length&&(i.activeColumn=e,o!==i.activeOrder?(i.activeDirection=s,i.activeOrder=o,i.updateFieldValue(i.orderField,o)):i.toggleDirection(),i.theForm.submit())})},checkFilter:function(i){var e=this,s=t(i).find("option:selected");""!==s.val()?e.activeFilter(i):e.deactiveFilter(i)},clear:function(){var i=this;i.getFilterFields().each(function(e,s){t(s).val(""),i.checkFilter(s),i.chosenSupport&&t(s).trigger("chosen:updated")}),i.clearListOptions&&(i.getListFields().each(function(e,s){t(s).val(""),i.checkFilter(s),i.chosenSupport&&t(s).trigger("chosen:updated")}),t("#list_limit").val(i.options.defaultLimit),i.chosenSupport&&t("#list_limit").trigger("chosen:updated")),i.searchField.val(""),i.theForm.submit()},activeFilter:function(i){t(i).addClass("active");var e="#"+t(i).attr("id")+"_chzn";t(e).addClass("active")},deactiveFilter:function(i){t(i).removeClass("active");var e="#"+t(i).attr("id")+"_chzn";t(e).removeClass("active")},getFilterFields:function(){return this.filterContainer.find("select")},getListFields:function(){return this.listContainer.find("select")},hideContainer:function(i){t(i).hide("fast"),t(i).removeClass("shown")},showContainer:function(i){t(i).show("fast"),t(i).addClass("shown")},toggleContainer:function(i){t(i).hasClass("shown")?this.hideContainer(i):this.showContainer(i)},hideList:function(){this.hideContainer(this.listContainer),this.listButton.removeClass("btn-primary")},showList:function(){this.showContainer(this.listContainer),this.listButton.addClass("btn-primary")},toggleList:function(){this.toggleContainer(this.listContainer),this.listContainer.hasClass("shown")?this.listButton.addClass("btn-primary"):this.listButton.removeClass("btn-primary")},hideFilters:function(){this.hideContainer(this.filterContainer),this.filterButton.removeClass("btn-primary")},showFilters:function(){this.showContainer(this.filterContainer),this.filterButton.addClass("btn-primary")},toggleFilters:function(){this.toggleContainer(this.filterContainer),this.filterContainer.hasClass("shown")?this.filterButton.addClass("btn-primary"):this.filterButton.removeClass("btn-primary")},toggleDirection:function(){var t=this,i="ASC";"ASC"==t.activeDirection.toUpperCase()&&(i="DESC"),t.activeDirection=i,t.activeOrder=t.activeColumn+" "+i,t.updateFieldValue(t.orderField,t.activeOrder)},createOrderField:function(){var i=this;this.orderField.length||(this.orderField=t("<input>").attr({type:"hidden",id:"js-stools-field-order","class":"js-stools-field-order",name:i.options.orderFieldName,value:i.activeOrder+" "+this.activeDirection}),this.orderField.appendTo(this.theForm)),this.orderField.is("select")&&(this.orderCols.each(function(){var e=t(this).attr("data-order"),s=t(this).attr("data-name"),o=t(this).attr("data-direction");if(e.length){e=e+" "+o;var r=i.findOption(i.orderField,e);if(!r.length){var r=t("<option>");r.text(s).val(e),t(this).hasClass("active")&&r.attr("selected","selected"),i.orderField.append(r)}}}),this.orderField.trigger("chosen:updated")),this.activeOrder=this.orderField.val()},updateFieldValue:function(i,e){var s=this,o=i.attr("type");if("hidden"===o||"text"===o)i.attr("value",e);else if(i.is("select")){var r=i.find("option").filter(function(){return t(this).val()==e});if(r.length)r.attr("selected","selected");else{var n=t("<option>");n.text(e).val(e),n.attr("selected","selected"),i.append(n)}s.chosenSupport&&i.trigger("chosen:updated")}},findOption:function(i,e){return i.find("option").filter(function(){return t(this).val()==e})}},t.fn[o]=function(i){return this.each(function(){t.data(this,"plugin_"+o)||t.data(this,"plugin_"+o,new s(this,i))})}}(jQuery,window,document);