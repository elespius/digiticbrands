(t=>{const e={TAB:9,ESC:27};t.define("joomla-field-simple-color",class extends HTMLElement{constructor(){super(),this.select="",this.options=[],this.icon="",this.panel="",this.buttons=[],this.focusableElements=null,this.focusableSelectors=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])']}connectedCallback(){if(this.select=this.querySelector("select"),!this.select)throw new Error("Simple color field requires a select element");this.options=[].slice.call(this.select.querySelectorAll("option")),this.select.classList.add("hidden"),this.options.forEach(t=>{let e=t.value,s="swatch";"none"===e&&(s+=" nocolor",e="transparent"),t.selected&&(s+=" active");const i=document.createElement("button");i.setAttribute("class",s),i.style.backgroundColor=e,i.setAttribute("type","button"),i.innerHTML=`<span class="sr-only">${this.textColor} ${e.replace("#","").split("").join(", ")}</span>`,this.buttons.push(i)});const t=document.createElement("button");t.setAttribute("class","btn-close"),t.setAttribute("type","button"),t.innerHTML=this.textClose,this.buttons.push(t);let e=this.select.value,s="";"none"===e&&(s+=" nocolor",e="transparent"),this.icon=document.createElement("button"),s&&this.icon.setAttribute("class",s),this.icon.setAttribute("type","button"),this.icon.setAttribute("tabindex","0"),this.icon.style.backgroundColor=e,this.icon.innerHTML='<span class="sr-only">'+this.textSelect+"</span>",this.select.insertAdjacentElement("beforebegin",this.icon),this.icon.addEventListener("click",this.show.bind(this)),this.panel=document.createElement("div"),this.panel.classList.add("simplecolors-panel"),this.buttons.forEach(t=>{t.classList.contains("btn-close")?t.addEventListener("click",this.hide.bind(this)):t.addEventListener("click",this.colorSelect.bind(this)),this.panel.insertAdjacentElement("beforeend",t)}),this.appendChild(this.panel),this.focusableElements=[].slice.call(this.panel.querySelectorAll(this.focusableSelectors.join())),this.keys=this.keys.bind(this),this.hide=this.hide.bind(this),this.mousedown=this.mousedown.bind(this)}disconnectedCallback(){}static get observedAttributes(){return["text-select","text-color"]}get textSelect(){return this.getAttribute("text-select")}get textColor(){return this.getAttribute("text-color")}get textClose(){return this.getAttribute("text-close")}show(){document.addEventListener("mousedown",this.hide),this.addEventListener("keydown",this.keys),this.panel.addEventListener("mousedown",this.mousedown),this.panel.setAttribute("data-open","");const t=this.panel.querySelector("button");t&&t.focus()}hide(){document.removeEventListener("mousedown",this.hide,!1),this.removeEventListener("keydown",this.keys),this.panel.hasAttribute("data-open")&&this.panel.removeAttribute("data-open"),this.icon.focus()}colorSelect(t){let e="",s="",i="";t.target.classList.contains("nocolor")?(e="none",s="transparent",i="nocolor"):(e=this.rgb2hex(t.target.style.backgroundColor),s=e),this.buttons.forEach(t=>{t.classList.contains("active")&&t.classList.remove("active")}),t.target.classList.add("active"),this.icon.classList.remove("nocolor"),this.icon.setAttribute("class",i),this.icon.style.backgroundColor=s,this.hide(),this.options.forEach(t=>{t.selected&&t.removeAttribute("selected"),t.value===s&&t.setAttribute("selected","")})}keys(t){if(t.keyCode===e.ESC&&this.hide(),t.keyCode===e.TAB){const e=this.focusableElements.indexOf(document.activeElement);!t.shiftKey||0!==e&&-1!==e||(this.focusableElements[this.focusableElements.length-1].focus(),t.preventDefault()),t.shiftKey||e!==this.focusableElements.length-1||(this.focusableElements[0].focus(),t.preventDefault())}}mousedown(t){t.stopPropagation(),t.preventDefault()}rgb2hex(t){const e=t=>("0"+parseInt(t,10).toString(16)).slice(-2),s=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return"#"+e(s[1])+e(s[2])+e(s[3])}})})(customElements);