customElements.define("joomla-field-tags",class extends HTMLElement{constructor(){super(),this.actualInput="",this.activeInput="",this.tagsContainer="",this.tags=[],this.values=[],this.dragSrcEl=null,this.prefixValue="#new#"}connectedCallback(){const t=this;if(this.actualInput=this.querySelector("input"),!this.actualInput)throw new Error("`joomla-field-tags` UI component is missing the input element");this.insert.bind(this),this.appendNewTag.bind(this);const e=JSON.parse(""===this.actualInput.value?{}:this.actualInput.value);for(const t in e)this.tags.push(t),this.values.push(e[t]);this.tagsContainer=document.createElement("div"),this.tagsContainer.classList.add("inline"),this.actualInput.insertAdjacentElement("afterend",this.tagsContainer),this.activeInput=this.actualInput.cloneNode(),this.actualInput.setAttribute("type","hidden"),this.actualInput.removeAttribute("id"),this.activeInput.setAttribute("type","text"),this.tagsContainer.appendChild(this.activeInput),this.activeInput.addEventListener("input",e=>{e.preventDefault(),e.stopPropagation(),t.insert(!1,e.target,!1)}),this.activeInput.addEventListener("keydown",e=>{if(13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),""!==t.activeInput.value&&(t.insert(!0,t.activeInput,!0),t.activeInput.focus())),8===e.keyCode&&""===t.activeInput.value){e.preventDefault(),e.stopPropagation();const a=t.activeInput.previousElementSibling.querySelector("span");console.log(t.activeInput.previousElementSibling),a.click(),t.activeInput.focus()}}),this.render(),this.activeInput.value=""}render(){const t=[].slice.call(this.tagsContainer.querySelectorAll("span.tag"));for(var e=0;e<this.tags.length;e++)t[e]?t[e].childNodes[0].nodeValue=this.tags[e]:this.appendNewTag(this.tags[e],this.values[e]);for(;e<t.length;e++)this.tagsContainer.removeChild(t[e]);const a={};for(e=0;e<this.tags.length;e++)a[this.tags[e]]=this.values[e];let s=JSON.stringify(a);s=s.replace(/\"/g,"&quot;"),this.actualInput.setAttribute("value",s),this.tagsContainer.insertAdjacentElement("beforeend",this.activeInput)}insert(t,e,a){if(-1!=e.value.indexOf(",")||t){","===e.value.substring(e.value.length-1)&&(e.value=e.value.substring(0,e.value.length-1));e.value.split(",").forEach(t=>{-1===this.tags.indexOf(t)&&(this.tags.push(t),this.values.push(this.prefixValue+t))}),e.value="",this.render()}}removeTag(t){if(this.tags.length){let e="";e=t&&"object"==typeof t&&t.target?t.target.parentNode:t.parentNode,this.tags.splice(this.tags.indexOf(e.childNodes[0].nodeValue),1),this.values.splice(this.values.indexOf(e.getAttribute("data-value")),1),this.render()}}handleDragStart(t){t.target.style.opacity="0.9",t.target.classList.remove("delete"),this.dragSrcEl=t.target,t.dataTransfer.effectAllowed="move"}handleDragEnter(t){t.target.style.opacity="0.6",t.target.classList.add("over")}handleDragLeave(t){t.srcElement.style.opacity=null,t.srcElement.classList.remove("over")}handleDragEnd(t){this.dragSrcEl.style.opacity=null,t.target.style.opacity=null,t.target.classList.add("delete"),this.dragSrcEl.classList.add("delete")}handleDragOver(t){t.preventDefault&&t.preventDefault(),t.dataTransfer.dropEffect="move"}handleDrop(t){if(t.stopPropagation&&t.stopPropagation(),t.target.classList.remove("over"),this.dragSrcEl!=t.target){const e=this.tags.indexOf(t.target.childNodes[0].nodeValue);this.tags[this.tags.indexOf(this.dragSrcEl.childNodes[0].nodeValue)]=t.target.childNodes[0].nodeValue,this.values[this.values.indexOf(this.dragSrcEl.getAttribute("data-value"))]=t.target.getAttribute("data-value"),this.tags[e]=this.dragSrcEl.childNodes[0].nodeValue,this.values[e]=this.dragSrcEl.getAttribute("data-value"),this.render()}t.target.style.opacity=null}appendNewTag(t,e){const a=this,s=document.createElement("span");s.className="tag delete",s.setAttribute("tabindex",0),s.draggable=!0,s.addEventListener("keyup",t=>{8!==t.keyCode&&46!==t.keyCode||(document.activeElement.previousSibling&&s.previousSibling.focus(),a.removeTag.bind(a)(t.target.querySelector("span.remove")))}),s.addEventListener("dragstart",this.handleDragStart.bind(this)),s.addEventListener("dragenter",this.handleDragEnter.bind(this)),s.addEventListener("dragleave",this.handleDragLeave.bind(this)),s.addEventListener("dragover",this.handleDragOver.bind(this)),s.addEventListener("dragend",this.handleDragEnd.bind(this)),s.addEventListener("drop",this.handleDrop.bind(this)),s.setAttribute("data-value",e),s.appendChild(document.createTextNode(t));const i=document.createElement("span");i.appendChild(document.createTextNode("âœ–")),i.className="remove",i.addEventListener("click",this.removeTag.bind(this)),s.appendChild(i),this.tagsContainer.appendChild(s)}});