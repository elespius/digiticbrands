((e,t,i)=>{if(!t)throw new Error("Joomla API is not properly initiated");t.selectedFile={},window.document.addEventListener("onMediaFileSelected",e=>{t.selectedFile=e.detail}),t.doIt=function(e,i,s){"use strict";if(!0===e.success){if(e.data[0].url)if(/local-/.test(e.data[0].adapter)){var r=t.getOptions("system.paths").rootFull;t.selectedFile.url=e.data[0].url.split(r)[1],e.data[0].thumb_path?t.selectedFile.thumb=e.data[0].thumb_path:t.selectedFile.thumb=!1}else e.data[0].thumb_path&&(t.selectedFile.thumb=e.data[0].thumb_path);else t.selectedFile.url=!1;const l=e=>"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName;t.selectedFile.url&&(l(i)||"object"==typeof i?!l(i)&&"object"==typeof i&&i.id?parent.window.Joomla.editors.instances[i.id].replaceSelection('<img src="'+t.selectedFile.url+'" alt=""/>'):(i.value=t.selectedFile.url,s.updatePreview()):t.editors.instances[i].replaceSelection('<img src="'+t.selectedFile.url+'" alt=""/>'))}},t.getImage=function(e,i,s){return new Promise((r,l)=>{var o=t.getOptions("csrf.token"),a=t.getOptions("system.paths").rootFull+"administrator/index.php?option=com_media&format=json";t.request({url:a+"&task=api.files&url=true&path="+e.path+"&"+o+"=1&format=json",method:"GET",perform:!0,headers:{"Content-Type":"application/json"},onSuccess:function(e){const l=JSON.parse(e);r(t.doIt(l,i,s))},onError:function(){l()}})})},e.define("joomla-field-media",class extends HTMLElement{constructor(){super(),this.css="joomla-field-media .field-media-preview{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;max-width:336px;height:180px !important;padding:10px;background-color:#f2f2f2;border:1px solid rgba(0,0,0,0.15);border-width:1px 1px 0;border-radius:.25rem .25rem 0 0;overflow:hidden}joomla-field-media .field-media-preview-icon{font-size:5rem;opacity:.25}joomla-field-media .field-media-input{border-top-left-radius:0}joomla-field-media .button-clear{border-top-right-radius:0}joomla-field-media img{max-width:100%;max-height:100%}",this.styleEl=document.createElement("style"),this.styleEl.id="joomla-field-media-css",this.styleEl.innerHTML=this.css,document.head.querySelector("joomla-field-media-css")||document.head.appendChild(this.styleEl)}static get observedAttributes(){return["type","base-path","root-folder","url","modal-container","modal-width","modal-height","input","button-select","button-clear","button-save-selected","preview","preview-width","preview-height"]}get type(){return this.getAttribute("type")}set type(e){this.setAttribute("type",e)}get basePath(){return this.getAttribute("base-path")}set basePath(e){this.setAttribute("base-path",e)}get rootFolder(){return this.getAttribute("root-folder")}set rootFolder(e){this.setAttribute("root-folder",e)}get url(){return this.getAttribute("url")}set url(e){this.setAttribute("url",e)}get modalContainer(){return this.getAttribute("modal-container")}set modalContainer(e){this.setAttribute("modal-container",e)}get input(){return this.getAttribute("input")}set input(e){this.setAttribute("input",e)}get buttonSelect(){return this.getAttribute("button-select")}set buttonSelect(e){this.setAttribute("button-select",e)}get buttonClear(){return this.getAttribute("button-clear")}set buttonClear(e){this.setAttribute("button-clear",e)}get buttonSaveSelected(){return this.getAttribute("button-save-selected")}set buttonSaveSelected(e){this.setAttribute("button-save-selected",e)}get modalWidth(){return this.getAttribute(parseInt("modal-width",10))}set modalWidth(e){this.setAttribute("modal-width",e)}get modalHeight(){return this.getAttribute(parseInt("modal-height",10))}set modalHeight(e){this.setAttribute("modal-height",e)}get previewWidth(){return this.getAttribute(parseInt("preview-width",10))}set previewWidth(e){this.setAttribute("preview-width",e)}get previewHeight(){return this.getAttribute(parseInt("preview-height",10))}set previewHeight(e){this.setAttribute("preview-height",e)}get preview(){return this.getAttribute("preview")}set preview(e){this.setAttribute("preview",e)}get previewContainer(){return this.getAttribute("preview-container")}connectedCallback(){const e=this.querySelector(this.buttonSelect),t=this.querySelector(this.buttonClear);this.show=this.show.bind(this),this.modalClose=this.modalClose.bind(this),this.clearValue=this.clearValue.bind(this),this.setValue=this.setValue.bind(this),this.updatePreview=this.updatePreview.bind(this),e.addEventListener("click",this.show),t&&t.addEventListener("click",this.clearValue),this.updatePreview()}disconnectedCallback(){const e=this.querySelector(this.buttonClear);e.removeEventListener("click",this)}show(){const e=this;i(this.querySelector('[role="dialog"]')).modal("show"),i(this.querySelector(this.buttonSaveSelected)).on("click",t=>(t.preventDefault(),t.stopPropagation(),this.selectedPath&&e.setValue(this.selectedPath),e.modalClose(),!1))}modalClose(){const e=this.querySelector(this.input);t.getImage(t.selectedFile,e,this),i(this.querySelector('[role="dialog"]')).modal("hide")}setValue(e){const t=i(this.querySelector(this.input));t.val(e).trigger("change"),this.updatePreview()}clearValue(){this.setValue("")}updatePreview(){if(-1!==["true","static"].indexOf(this.preview)&&"false"!==this.preview&&this.preview){const e=this.querySelector(this.input).value,i=this.querySelector(".field-media-preview");if(e){i.innerHTML="";const s=new Image;switch(this.type){case"image":s.src=s.src=/http/.test(e)?e:t.getOptions("system.paths").rootFull+e}i.style.width=this.previewWidth,i.appendChild(s)}else i.innerHTML='<span class="field-media-preview-icon fa fa-picture-o"></span>'}}})})(customElements,Joomla,jQuery);