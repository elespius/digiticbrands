var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var l=e[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}return function(e,n,l){return n&&t(e.prototype,n),l&&t(e,l),e}}();function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}!function(customElements,Joomla,$){var ALLOW_NEW=1,ALLOW_EDIT=2,ALLOW_CLEAR=4,ALLOW_SELECT=8;function getElement(t,e){var n=document.createElement(t);if(e)for(var l in e)e.hasOwnProperty(l)&&n.setAttribute(l,e[l]);for(var s=arguments.length,i=Array(s>2?s-2:0),o=2;o<s;o++)i[o-2]=arguments[o];return i.forEach(function(t){"string"==typeof t?n.appendChild(document.createTextNode(t)):t instanceof HTMLElement&&n.appendChild(t)}),n}function templateFactory(tmpl){function template(t){for(var e=arguments.length,n=Array(e>1?e-1:0),l=1;l<e;l++)n[l-1]=arguments[l];return function(){for(var e=arguments.length,l=Array(e),s=0;s<e;s++)l[s]=arguments[s];var i=n.map(function(e,n){return t[n]+l[parseInt(e)]});return i.push(t[t.length-1]),i.join("")}}return tmpl=tmpl.replace(/\\|`/g,"\\$&"),eval("template`"+tmpl+"`")}customElements.define("joomla-field-modal",function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(!Joomla)throw new Error("Joomla API is not properly initiated");return t.initialText=t.innerText,t.innerText="","function"==typeof Joomla.renderModalField?Joomla.renderModalField.call(t):t.render(),t}return _inherits(e,HTMLElement),_createClass(e,[{key:"render",value:function(){this.createElements(),this.assembleElements()}},{key:"createElements",value:function(){var t=this,e=!!this.getAttribute("value");this.elements={},this.elements.wrapper=getElement("span",{class:this.allow?"input-group":""}),this.elements.fieldTitle=getElement("input",{class:"form-control",id:this.getAttribute("id")+"_name",type:"text",value:this.initialText,placeholder:this.getAttribute("text-placeholder"),disabled:"disabled",size:"35"}),this.elements.fieldId=getElement("input",{name:this.getAttribute("name"),id:this.getAttribute("id")+"_id",type:"hidden",value:this.getAttribute("value"),required:this.getAttribute("required")});var n={role:"button",class:"btn","aria-hidden":"true"};if(this.elements.modalButtonClose=getElement("a",n,this.getAttribute("text-modal-button-close")),this.elements.modalButtonClose.classList.add("btn-secondary"),this.elements.modalButtonClose.setAttribute("data-task","cancel"),this.elements.modalButtonSave=getElement("a",n,this.getAttribute("text-modal-button-save")),this.elements.modalButtonSave.classList.add("btn-primary"),this.elements.modalButtonSave.setAttribute("data-task","save"),this.elements.modalButtonApply=getElement("a",n,this.getAttribute("text-modal-button-apply")),this.elements.modalButtonApply.classList.add("btn-success"),this.elements.modalButtonApply.setAttribute("data-task","apply"),this.allow){this.elements.buttonGroup=getElement("span",{class:"input-group-append"});var l={class:"btn hasTooltip",type:"button"};this.allow&ALLOW_SELECT&&(this.elements.buttonSelect=getElement("button",l,getElement("span",{class:"icon-file","aria-hidden":"true"})," ",this.getAttribute("text-button-select")),this.elements.buttonSelect.classList.add("btn-primary"),this.elements.buttonSelect.classList[e?"add":"remove"]("sr-only"),this.elements.buttonSelect.addEventListener("click",function(e){return t.modalSelect(e)},!0)),this.allow&ALLOW_NEW&&(this.elements.buttonNew=getElement("button",l,getElement("span",{class:"icon-new","aria-hidden":"true"})," ",this.getAttribute("text-button-create")),this.elements.buttonNew.classList.add("btn-secondary"),this.elements.buttonNew.classList[e?"add":"remove"]("sr-only"),this.elements.buttonNew.addEventListener("click",function(e){return t.modalNew(e)},!0)),this.allow&ALLOW_EDIT&&(this.elements.buttonEdit=getElement("button",l,getElement("span",{class:"icon-edit","aria-hidden":"true"})," ",this.getAttribute("text-button-edit")),this.elements.buttonEdit.classList.add("btn-secondary"),this.elements.buttonEdit.classList[e?"remove":"add"]("sr-only"),this.elements.buttonEdit.addEventListener("click",function(e){return t.modalEdit(e)},!0)),this.allow&ALLOW_CLEAR&&(this.elements.buttonClear=getElement("button",l,getElement("span",{class:"icon-remove","aria-hidden":"true"})," ",this.getAttribute("text-button-clear")),this.elements.buttonClear.classList.add("btn-secondary"),this.elements.buttonClear.classList[e?"remove":"add"]("sr-only"),this.elements.buttonClear.addEventListener("click",function(e){return t.clear(e)},!0))}}},{key:"assembleElements",value:function(){this.elements.wrapper.appendChild(this.elements.fieldId),this.elements.wrapper.appendChild(this.elements.fieldTitle),this.elements.buttonGroup&&(this.elements.wrapper.appendChild(this.elements.buttonGroup),this.elements.buttonSelect&&this.elements.buttonGroup.appendChild(this.elements.buttonSelect),this.elements.buttonNew&&this.elements.buttonGroup.appendChild(this.elements.buttonNew),this.elements.buttonEdit&&this.elements.buttonGroup.appendChild(this.elements.buttonEdit),this.elements.buttonClear&&this.elements.buttonGroup.appendChild(this.elements.buttonClear)),this.appendChild(this.elements.wrapper)}},{key:"modalSelect",value:function(t){var e=this,n=this.getAttribute("text-title-select"),l=getElement("iframe",{class:"iframe",src:this.getAttribute("url-select"),name:""}),s=getElement("a",{role:"button",class:"btn btn-secondary","data-dismiss":"modal","aria-hidden":"true"},"Close");this.openModal(n,l,s,{closeButton:!0}).then(function(t){return e.processResult.apply(e,_toConsumableArray(t))},function(t){})}},{key:"modalNew",value:function(t){var e=this,n=this.getAttribute("text-title-new"),l=getElement("iframe",{class:"iframe",src:this.getAttribute("url-new"),name:""}),s=[this.elements.modalButtonClose,this.elements.modalButtonSave,this.elements.modalButtonApply];this.openModal(n,l,s,{backdrop:"static",keyboard:!1,closeButton:!1}).then(function(t){return e.processResult.apply(e,_toConsumableArray(t))},function(t){})}},{key:"modalEdit",value:function(t){var e=this,n=templateFactory(this.getAttribute("url-edit")),l=this.getAttribute("text-title-edit"),s=getElement("iframe",{class:"iframe",src:n(this.elements.fieldId.value),name:""}),i=[this.elements.modalButtonClose,this.elements.modalButtonSave,this.elements.modalButtonApply];this.openModal(l,s,i,{backdrop:"static",keyboard:!1,closeButton:!1}).then(function(t){return e.processResult.apply(e,_toConsumableArray(t))},function(t){})}},{key:"clear",value:function(t){this.processResult()}},{key:"openModal",value:function(t,e,n,l){var s=this;e=e instanceof Array?e:[e],n=n instanceof Array?n:[n];var i=getElement("div",{role:"dialog",tabindex:"-1",class:"joomla-modal modal fade show"},getElement("div",{class:"modal-dialog modal-lg jviewport-width80",role:"document"},getElement("div",{class:"modal-content"},getElement("div",{class:"modal-header"},getElement("h3",{class:"modal-title"},t||"Title"),l.closeButton?getElement("button",{type:"button",class:"close novalidate","data-dismiss":"modal"},"Ã—"):""),getElement.apply(void 0,["div",{class:"modal-body jviewport-height70"}].concat(_toConsumableArray(e))),getElement.apply(void 0,["div",{class:"modal-footer"}].concat(_toConsumableArray(n)))))),o=[].slice.call(i.getElementsByTagName("iframe")).shift();if(o){i.classList.add("sr-only"),o.addEventListener("load",function t(){i.classList.remove("sr-only"),o.removeEventListener("load",t)})}var a=null;window.jModalSelect=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];a=e,$(i).modal("hide")};[this.elements.modalButtonClose,this.elements.modalButtonSave,this.elements.modalButtonApply].forEach(function(t){if(t.parentNode){var e=t.cloneNode(!0);t.parentNode.replaceChild(e,t),e.addEventListener("click",function(t){return function(t){var e=t.target.getAttribute("data-task")||"cancel",n=(s.getAttribute("item-type")||"item").toLowerCase(),l=s.getAttribute("form-id")||n+"-form",o=s.getAttribute("id-field-id")||"jform_id",r=s.getAttribute("title-field-id")||"jform_title",u=[].slice.call(i.getElementsByTagName("iframe")).shift(),d=u.contentWindow,m=u.contentDocument;"cancel"===e&&(d.Joomla.submitbutton(n+"."+e),$(i).modal("hide")),m.formvalidator.isValid(m.getElementById(l))&&(u.addEventListener("load",function t(l){u.removeEventListener("load",t);var s=u.contentDocument,m=s.getElementById(o),c=s.getElementById(r);m&&"0"!=m.value&&(a=[m.value,c&&c.value],"save"===e&&(d.Joomla.submitbutton(n+".cancel"),$(i).modal("hide"))),u.classList.remove("sr-only")}),"save"===e&&u.classList.add("sr-only"),d.Joomla.submitbutton(n+".apply"))}(t)})}}),$(i).modal(l).one("hidden.bs.modal",function(){return i.parentNode.removeChild(i)});var r=new Promise(function(t,e){return $(i).one("hide.bs.modal",function(n){return a?t(a):e()})});return r.finally(function(t){return window.jModalSelect=null}),r}},{key:"processResult",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";t=t||"",e=e||"",n=n||"",l=l||"",s=s||"",i=i||"",this.elements.fieldId.value=t||"",this.elements.fieldTitle.value=t?e:"",this.elements.buttonSelect&&this.elements.buttonSelect.classList[t?"add":"remove"]("sr-only"),this.elements.buttonNew&&this.elements.buttonNew.classList[t?"add":"remove"]("sr-only"),this.elements.buttonEdit&&this.elements.buttonEdit.classList[t?"remove":"add"]("sr-only"),this.elements.buttonClear&&this.elements.buttonClear.classList[t?"remove":"add"]("sr-only"),"1"==this.elements.fieldId.getAttribute("data-required")&&(document.formvalidator.validate(this.elements.fieldId),document.formvalidator.validate(this.elements.fieldTitle))}},{key:"allow",get:function(){return("true"==this.getAttribute("allow-new")?ALLOW_NEW:0)|("true"==this.getAttribute("allow-edit")?ALLOW_EDIT:0)|("false"!=this.getAttribute("allow-clear")?ALLOW_CLEAR:0)|("false"!=this.getAttribute("allow-select")?ALLOW_SELECT:0)}}]),e}())}(customElements,Joomla,jQuery);