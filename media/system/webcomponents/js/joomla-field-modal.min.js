((customElements,Joomla,$)=>{const ALLOW_NEW=1,ALLOW_EDIT=2,ALLOW_CLEAR=4,ALLOW_SELECT=8;function getElement(t,e,...l){let s=document.createElement(t);if(e)for(let t in e)e.hasOwnProperty(t)&&s.setAttribute(t,e[t]);return l.forEach(t=>{"string"==typeof t?s.appendChild(document.createTextNode(t)):t instanceof HTMLElement&&s.appendChild(t)}),s}function templateFactory(tmpl){function template(t,...e){return(...l)=>{let s=e.map((e,s)=>t[s]+l[parseInt(e)]);return s.push(t[t.length-1]),s.join("")}}return tmpl=tmpl.replace(/\\|`/g,"\\$&"),eval("template`"+tmpl+"`")}customElements.define("joomla-field-modal",class extends HTMLElement{constructor(){if(super(),!Joomla)throw new Error("Joomla API is not properly initiated");this.initialText=this.innerText,this.innerText="","function"==typeof Joomla.renderModalField?Joomla.renderModalField.call(this):this.render()}get allow(){return("true"===this.getAttribute("allow-new")?ALLOW_NEW:0)|("true"===this.getAttribute("allow-edit")?ALLOW_EDIT:0)|("false"!==this.getAttribute("allow-clear")?ALLOW_CLEAR:0)|("false"!==this.getAttribute("allow-select")?ALLOW_SELECT:0)}render(){this.createElements(),this.assembleElements()}createElements(){let t=!!this.getAttribute("value");this.elements={},this.elements.wrapper=getElement("span",{class:this.allow?"input-group":""}),this.elements.fieldTitle=getElement("input",{class:"form-control",id:this.getAttribute("id")+"_name",type:"text",value:this.initialText,placeholder:this.getAttribute("text-placeholder"),disabled:"disabled",size:"35"}),this.elements.fieldId=getElement("input",{name:this.getAttribute("name"),id:this.getAttribute("id")+"_id",type:"hidden",value:this.getAttribute("value"),required:this.getAttribute("required")});let e={role:"button",class:"btn","aria-hidden":"true"};if(this.elements.modalButtonClose=getElement("a",e,this.getAttribute("text-modal-button-close")),this.elements.modalButtonClose.classList.add("btn-secondary"),this.elements.modalButtonClose.setAttribute("data-task","cancel"),this.elements.modalButtonSave=getElement("a",e,this.getAttribute("text-modal-button-save")),this.elements.modalButtonSave.classList.add("btn-primary"),this.elements.modalButtonSave.setAttribute("data-task","save"),this.elements.modalButtonApply=getElement("a",e,this.getAttribute("text-modal-button-apply")),this.elements.modalButtonApply.classList.add("btn-success"),this.elements.modalButtonApply.setAttribute("data-task","apply"),!this.allow)return;this.elements.buttonGroup=getElement("span",{class:"input-group-append"});let l={class:"btn hasTooltip",type:"button"};this.allow&ALLOW_SELECT&&(this.elements.buttonSelect=getElement("button",l,getElement("span",{class:"icon-file","aria-hidden":"true"})," ",this.getAttribute("text-button-select")),this.elements.buttonSelect.classList.add("btn-primary"),this.elements.buttonSelect.classList[t?"add":"remove"]("sr-only"),this.elements.buttonSelect.addEventListener("click",t=>this.modalSelect(t),!0)),this.allow&ALLOW_NEW&&(this.elements.buttonNew=getElement("button",l,getElement("span",{class:"icon-new","aria-hidden":"true"})," ",this.getAttribute("text-button-create")),this.elements.buttonNew.classList.add("btn-secondary"),this.elements.buttonNew.classList[t?"add":"remove"]("sr-only"),this.elements.buttonNew.addEventListener("click",t=>this.modalNew(t),!0)),this.allow&ALLOW_EDIT&&(this.elements.buttonEdit=getElement("button",l,getElement("span",{class:"icon-edit","aria-hidden":"true"})," ",this.getAttribute("text-button-edit")),this.elements.buttonEdit.classList.add("btn-secondary"),this.elements.buttonEdit.classList[t?"remove":"add"]("sr-only"),this.elements.buttonEdit.addEventListener("click",t=>this.modalEdit(t),!0)),this.allow&ALLOW_CLEAR&&(this.elements.buttonClear=getElement("button",l,getElement("span",{class:"icon-remove","aria-hidden":"true"})," ",this.getAttribute("text-button-clear")),this.elements.buttonClear.classList.add("btn-secondary"),this.elements.buttonClear.classList[t?"remove":"add"]("sr-only"),this.elements.buttonClear.addEventListener("click",t=>this.clear(t),!0))}assembleElements(){this.elements.wrapper.appendChild(this.elements.fieldId),this.elements.wrapper.appendChild(this.elements.fieldTitle),this.elements.buttonGroup&&(this.elements.wrapper.appendChild(this.elements.buttonGroup),this.elements.buttonSelect&&this.elements.buttonGroup.appendChild(this.elements.buttonSelect),this.elements.buttonNew&&this.elements.buttonGroup.appendChild(this.elements.buttonNew),this.elements.buttonEdit&&this.elements.buttonGroup.appendChild(this.elements.buttonEdit),this.elements.buttonClear&&this.elements.buttonGroup.appendChild(this.elements.buttonClear)),this.appendChild(this.elements.wrapper)}modalSelect(t){let e=this.getAttribute("text-title-select"),l=getElement("iframe",{class:"iframe",src:this.getAttribute("url-select"),name:""}),s=getElement("a",{role:"button",class:"btn btn-secondary","data-dismiss":"modal","aria-hidden":"true"},"Close");this.openModal(e,l,s,{closeButton:!0}).then(t=>this.processResult(...t),t=>{})}modalNew(t){let e=this.getAttribute("text-title-new"),l=getElement("iframe",{class:"iframe",src:this.getAttribute("url-new"),name:""}),s=[this.elements.modalButtonClose,this.elements.modalButtonSave,this.elements.modalButtonApply];this.openModal(e,l,s,{backdrop:"static",keyboard:!1,closeButton:!1}).then(t=>this.processResult(...t),t=>{})}modalEdit(t){let e=templateFactory(this.getAttribute("url-edit")),l=this.getAttribute("text-title-edit"),s=getElement("iframe",{class:"iframe",src:e(this.elements.fieldId.value),name:""}),n=[this.elements.modalButtonClose,this.elements.modalButtonSave,this.elements.modalButtonApply];this.openModal(l,s,n,{backdrop:"static",keyboard:!1,closeButton:!1}).then(t=>this.processResult(...t),t=>{})}clear(t){this.processResult()}openModal(t,e,l,s){e=e instanceof Array?e:[e],l=l instanceof Array?l:[l];let n=getElement("div",{role:"dialog",tabindex:"-1",class:"joomla-modal modal fade show"},getElement("div",{class:"modal-dialog modal-lg jviewport-width80",role:"document"},getElement("div",{class:"modal-content"},getElement("div",{class:"modal-header"},getElement("h3",{class:"modal-title"},t||"Title"),s.closeButton?getElement("button",{type:"button",class:"close novalidate","data-dismiss":"modal"},"Ã—"):""),getElement("div",{class:"modal-body jviewport-height70"},...e),getElement("div",{class:"modal-footer"},...l)))),i=[].slice.call(n.getElementsByTagName("iframe")).shift();if(i){n.classList.add("sr-only"),i.addEventListener("load",function t(){n.classList.remove("sr-only"),i.removeEventListener("load",t)})}let a=null;window.jModalSelect=((...t)=>{a=t,$(n).modal("hide")});let o=t=>{let e=t.target.getAttribute("data-task")||"cancel",l=(this.getAttribute("item-type")||"item").toLowerCase(),s=this.getAttribute("form-id")||l+"-form",i=this.getAttribute("id-field-id")||"jform_id",o=this.getAttribute("title-field-id")||"jform_title",d=[].slice.call(n.getElementsByTagName("iframe")).shift(),m=d.contentWindow,r=d.contentDocument;"cancel"===e&&(m.Joomla.submitbutton(l+"."+e),$(n).modal("hide")),r.formvalidator.isValid(r.getElementById(s))&&(d.addEventListener("load",function t(s){d.removeEventListener("load",t);let r=d.contentDocument,u=r.getElementById(i),h=r.getElementById(o);u&&"0"!=u.value&&(a=[u.value,h&&h.value],"save"===e&&(m.Joomla.submitbutton(`${l}.cancel`),$(n).modal("hide"))),d.classList.remove("sr-only")}),"save"===e&&d.classList.add("sr-only"),m.Joomla.submitbutton(`${l}.apply`))};[this.elements.modalButtonClose,this.elements.modalButtonSave,this.elements.modalButtonApply].forEach(t=>{if(!t.parentNode)return;let e=t.cloneNode(!0);t.parentNode.replaceChild(e,t),e.addEventListener("click",t=>o(t))}),$(n).modal(s).one("hidden.bs.modal",()=>n.parentNode.removeChild(n));let d=new Promise((t,e)=>{$(n).one("hide.bs.modal",l=>a?t(a):e())});return d.finally(()=>{window.jModalSelect=null}),d}processResult(t="",e="",l="",s="",n="",i=""){this.elements.fieldId.value=t||"",this.elements.fieldTitle.value=t?e:"",this.elements.buttonSelect&&this.elements.buttonSelect.classList[t?"add":"remove"]("sr-only"),this.elements.buttonNew&&this.elements.buttonNew.classList[t?"add":"remove"]("sr-only"),this.elements.buttonEdit&&this.elements.buttonEdit.classList[t?"remove":"add"]("sr-only"),this.elements.buttonClear&&this.elements.buttonClear.classList[t?"remove":"add"]("sr-only"),"1"===this.elements.fieldId.getAttribute("data-required")&&(document.formvalidator.validate(this.elements.fieldId),document.formvalidator.validate(this.elements.fieldTitle))}})})(customElements,Joomla,jQuery);