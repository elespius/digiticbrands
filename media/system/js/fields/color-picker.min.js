var JUIColorPicker=function(){"use strict";function t(e){return e instanceof t==!0?void this.copy(e):(this.r=0,this.g=0,this.b=0,this.a=1,this.hue=0,this.saturation=0,this.value=0,this.lightness=0,void(this.format="HSV"))}function e(e,i,o){var s=new t;return s.setRGBA(e,i,o,1),s}function i(e,i,o,s){var r=new t;return r.setRGBA(e,i,o,s),r}function o(e,i,o){var s=new t;return s.setHSV(e,i,o),s}function s(e,i,o,s){var r=new t;return r.setHSV(e,i,o),r.a=s,r}function r(e,i,o){var s=new t;return s.setHSL(e,i,o),s}function n(e,i,o,s){var r=new t;return r.setHSL(e,i,o),r.a=s,r}function a(e){this.color=new t,this.node=e,this.subscribers=[];var i=this.node.getAttribute("data-mode"),o=this.node.getAttribute("data-topic");this.topic=o,this.picker_mode="HSL"===i?"HSL":"HSV",this.color.setFormat(this.picker_mode),this.mode=this.node.getAttribute("data-format"),this.createPickingArea(),this.createHueArea(),this.newInputComponent("H","hue",this.inputChangeHue.bind(this)),this.newInputComponent("S","saturation",this.inputChangeSaturation.bind(this)),this.newInputComponent("V","value",this.inputChangeValue.bind(this)),this.newInputComponent("L","lightness",this.inputChangeLightness.bind(this)),this.createAlphaArea(),this.newInputComponent("R","red",this.inputChangeRed.bind(this)),this.newInputComponent("G","green",this.inputChangeGreen.bind(this)),this.newInputComponent("B","blue",this.inputChangeBlue.bind(this)),this.createPreviewBox(),this.newInputComponent("alpha","alpha",this.inputChangeAlpha.bind(this)),this.newInputComponent("hexa","hexa",this.inputChangeHexa.bind(this)),this.setColor(this.color),u[o]=this}var h=[],u=[];t.prototype.copy=function(e){return e instanceof t!=!0?void console.log("Typeof parameter not Color"):(this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this.hue=e.hue,this.saturation=e.saturation,this.value=e.value,this.format=""+e.format,void(this.lightness=e.lightness))},t.prototype.setFormat=function(t){"HSV"===t&&(this.format="HSV"),"HSL"===t&&(this.format="HSL")},t.prototype.isValidRGBValue=function(t){return"number"==typeof t&&isNaN(t)===!1&&t>=0&&255>=t},t.prototype.setRGBA=function(t,e,i,o){this.isValidRGBValue(t)!==!1&&this.isValidRGBValue(e)!==!1&&this.isValidRGBValue(i)!==!1&&(this.r=0|t,this.g=0|e,this.b=0|i,this.isValidRGBValue(o)===!0&&(this.a=0|o))},t.prototype.setByName=function(t,e){if("r"===t||"g"===t||"b"===t){if(this.isValidRGBValue(e)===!1)return;this[t]=e,this.updateHSX()}},t.prototype.setHSV=function(t,e,i){this.hue=t,this.saturation=e,this.value=i,this.HSVtoRGB()},t.prototype.setHSL=function(t,e,i){this.hue=t,this.saturation=e,this.lightness=i,this.HSLtoRGB()},t.prototype.setHue=function(t){"number"!=typeof t||isNaN(t)===!0||0>t||t>359||(this.hue=t,this.updateRGB())},t.prototype.setSaturation=function(t){"number"!=typeof t||isNaN(t)===!0||0>t||t>100||(this.saturation=t,this.updateRGB())},t.prototype.setValue=function(t){"number"!=typeof t||isNaN(t)===!0||0>t||t>100||(this.value=t,this.HSVtoRGB())},t.prototype.setLightness=function(t){"number"!=typeof t||isNaN(t)===!0||0>t||t>100||(this.lightness=t,this.HSLtoRGB())},t.prototype.setAlpha=function(t){"number"!=typeof t||isNaN(t)===!0||0>t||t>1||(this.a=parseFloat(t.toFixed(2)))},t.prototype.setHexa=function(t){var e=/(^#{0,1}[0-9A-F]{6}$)|(^#{0,1}[0-9A-F]{3}$)/i.test(t);e===!0&&("#"===t[0]&&(t=t.slice(1,t.length)),3===t.length&&(t=t.replace(/([0-9A-F])([0-9A-F])([0-9A-F])/i,"$1$1$2$2$3$3")),this.r=parseInt(t.substr(0,2),16),this.g=parseInt(t.substr(2,2),16),this.b=parseInt(t.substr(4,2),16),this.alpha=1,this.RGBtoHSV())},t.prototype.convertToHSL=function(){"HSL"!==this.format&&(this.setFormat("HSL"),this.RGBtoHSL())},t.prototype.convertToHSV=function(){"HSV"!==this.format&&(this.setFormat("HSV"),this.RGBtoHSV())},t.prototype.updateRGB=function(){return"HSV"===this.format?void this.HSVtoRGB():"HSL"===this.format?void this.HSLtoRGB():void 0},t.prototype.updateHSX=function(){return"HSV"===this.format?void this.RGBtoHSV():"HSL"===this.format?void this.RGBtoHSL():void 0},t.prototype.HSVtoRGB=function(){var t=this.saturation/100,e=this.value/100,i=t*e,o=this.hue/60,s=i*(1-Math.abs(o%2-1)),r=e-i,n=255;return i=(i+r)*n|0,s=(s+r)*n|0,r=r*n|0,o>=0&&1>o?void this.setRGBA(i,s,r):o>=1&&2>o?void this.setRGBA(s,i,r):o>=2&&3>o?void this.setRGBA(r,i,s):o>=3&&4>o?void this.setRGBA(r,s,i):o>=4&&5>o?void this.setRGBA(s,r,i):o>=5&&6>o?void this.setRGBA(i,r,s):void 0},t.prototype.HSLtoRGB=function(){var t=this.saturation/100,e=this.lightness/100,i=t*(1-Math.abs(2*e-1)),o=this.hue/60,s=i*(1-Math.abs(o%2-1)),r=e-i/2,n=255;return i=(i+r)*n|0,s=(s+r)*n|0,r=r*n|0,o>=0&&1>o?void this.setRGBA(i,s,r):o>=1&&2>o?void this.setRGBA(s,i,r):o>=2&&3>o?void this.setRGBA(r,i,s):o>=3&&4>o?void this.setRGBA(r,s,i):o>=4&&5>o?void this.setRGBA(s,r,i):o>=5&&6>o?void this.setRGBA(i,r,s):void 0},t.prototype.RGBtoHSV=function(){var t=this.r/255,e=this.g/255,i=this.b/255,o=Math.max(t,e,i),s=Math.min(t,e,i),r=o-s,n=0,a=0;r&&(o===t&&(n=(e-i)/r),o===e&&(n=2+(i-t)/r),o===i&&(n=4+(t-e)/r),o&&(a=r/o)),this.hue=60*n|0,this.hue<0&&(this.hue+=360),this.saturation=100*a|0,this.value=100*o|0},t.prototype.RGBtoHSL=function(){var t=this.r/255,e=this.g/255,i=this.b/255,o=Math.max(t,e,i),s=Math.min(t,e,i),r=o-s,n=0,a=0,h=(o+s)/2,u=1-Math.abs(2*h-1);r&&(o===t&&(n=(e-i)/r),o===e&&(n=2+(i-t)/r),o===i&&(n=4+(t-e)/r),o&&(a=r/u)),this.hue=60*n|0,this.hue<0&&(this.hue+=360),this.saturation=100*a|0,this.lightness=100*h|0},t.prototype.getHexa=function(){var t=this.r.toString(16),e=this.g.toString(16),i=this.b.toString(16);this.r<16&&(t="0"+t),this.g<16&&(e="0"+e),this.b<16&&(i="0"+i);var o="#"+t+e+i;return o.toUpperCase()},t.prototype.getRGBA=function(){var t="("+this.r+", "+this.g+", "+this.b,e="",i="",o=parseFloat(this.a);1!==o&&(e="a",i=", "+o);var s="rgb"+e+t+i+")";return s},t.prototype.getHSLA=function(){if("HSV"===this.format){var e=new t(this);return e.setFormat("HSL"),e.updateHSX(),e.getHSLA()}var i="",o="",s="("+this.hue+", "+this.saturation+"%, "+this.lightness+"%",r=parseFloat(this.a);1!==r&&(i="a",o=", "+r);var n="hsl"+i+s+o+")";return n},t.prototype.getColor=function(){return this.a|!1?this.getHexa():this.getRGBA()};var p=function(t,e){t.addEventListener("mousedown",function(t){e(t),document.addEventListener("mousemove",e)}),document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",e)})};a.prototype.createPickingArea=function(){var t=document.createElement("div"),e=document.createElement("div");t.className="picking-area",e.className="picker",this.picking_area=t,this.color_picker=e,p(t,this.updateColor.bind(this)),t.appendChild(e),this.node.appendChild(t)},a.prototype.createHueArea=function(){var t=document.createElement("div"),e=document.createElement("div");t.className="hue",e.className="slider-picker",this.hue_area=t,this.hue_picker=e,p(t,this.updateHueSlider.bind(this)),t.appendChild(e),this.node.appendChild(t)},a.prototype.createAlphaArea=function(){var t=document.createElement("div"),e=document.createElement("div");t.className="alpha",e.className="slider-picker",this.alpha_mask=t,this.alpha_picker=e,p(t,this.updateAlphaSlider.bind(this)),t.appendChild(e),this.node.appendChild(t)},a.prototype.createPreviewBox=function(){var t=this.node.parentNode.parentNode;this.preview_color=t.querySelector(".preview-color")},a.prototype.newInputComponent=function(t,e,i){var o=document.createElement("div"),s=document.createElement("input"),r=document.createElement("span");o.className="input",o.setAttribute("data-topic",e),r.textContent=t,r.className="name",s.setAttribute("type","text"),s.className="form-control",o.appendChild(r),o.appendChild(s),this.node.appendChild(o),s.addEventListener("change",i),s.addEventListener("click",function(){this.select()}),this.subscribe(e,function(t){s.value=t})},a.prototype.updateColor=function(t){var e=t.pageX-this.picking_area.getBoundingClientRect().left,i=t.pageY-this.picking_area.getBoundingClientRect().top,o=this.picking_area.getBoundingClientRect().width;e>o&&(e=o),i>o&&(i=o),0>e&&(e=0),0>i&&(i=0);var s=100-100*i/o|0,r=100*e/o|0;"HSV"===this.picker_mode&&this.color.setHSV(this.color.hue,r,s),"HSL"===this.picker_mode&&this.color.setHSL(this.color.hue,r,s),this.color_picker.style.left=e+"px",this.color_picker.style.top=i+"px",this.updateAlphaGradient(),this.updatePreviewColor(),this.notify("value",s),this.notify("lightness",s),this.notify("saturation",r),this.notify("red",this.color.r),this.notify("green",this.color.g),this.notify("blue",this.color.b),this.notify("hexa",this.color.getHexa()),g(this.topic,this.color)},a.prototype.updateHueSlider=function(t){var e=t.pageX-this.hue_area.getBoundingClientRect().left,i=this.hue_area.getBoundingClientRect().width;0>e&&(e=0),e>i&&(e=i);var o=359*e/i|0;this.updateSliderPosition(this.hue_picker,e-1),this.setHue(o)},a.prototype.updateAlphaSlider=function(t){var e=t.pageX-this.alpha_mask.getBoundingClientRect().left,i=this.alpha_mask.getBoundingClientRect().width;0>e&&(e=0),e>i&&(e=i),this.color.a=(e/i).toFixed(2),this.updateSliderPosition(this.alpha_picker,e-1),this.updatePreviewColor(),this.notify("alpha",this.color.a),g(this.topic,this.color)},a.prototype.setHue=function(t){this.color.setHue(t),this.updatePickerBackground(),this.updateAlphaGradient(),this.updatePreviewColor(),this.notify("red",this.color.r),this.notify("green",this.color.g),this.notify("blue",this.color.b),this.notify("hexa",this.color.getHexa()),this.notify("hue",this.color.hue),g(this.topic,this.color)},a.prototype.updateSLV=function(){this.updatePickerPosition(),this.updateAlphaGradient(),this.updatePreviewColor(),this.notify("red",this.color.r),this.notify("green",this.color.g),this.notify("blue",this.color.b),this.notify("hexa",this.color.getHexa()),g(this.topic,this.color)},a.prototype.updatePickerPosition=function(){var t=this.picking_area.getBoundingClientRect().width,e=0;"HSV"===this.picker_mode&&(e=this.color.value),"HSL"===this.picker_mode&&(e=this.color.lightness);var i=this.color.saturation*t/100|0,o=t-e*t/100|0;this.color_picker.style.left=i+"px",this.color_picker.style.top=o+"px"},a.prototype.updateSliderPosition=function(t,e){t.style.left=e+"px"},a.prototype.updateHuePicker=function(){var t=this.hue_area.getBoundingClientRect().width,e=this.color.hue*t/360|0;this.hue_picker.style.left=e+"px"},a.prototype.updateAlphaPicker=function(){var t=this.alpha_mask.getBoundingClientRect().width,e=this.color.a*t|0;this.alpha_picker.style.left=e+"px"},a.prototype.updatePickerBackground=function(){var e=new t(this.color);e.setHSV(e.hue,100,100),this.picking_area.style.backgroundColor=e.getHexa()},a.prototype.updateAlphaGradient=function(){this.alpha_mask.style.backgroundColor=this.color.getHexa()},a.prototype.updatePreviewColor=function(){this.preview_color.style.backgroundColor=this.color.getColor()},a.prototype.inputChangeHue=function(t){var e=parseInt(t.target.value);this.setHue(e),this.updateHuePicker()},a.prototype.inputChangeSaturation=function(t){var e=parseInt(t.target.value);this.color.setSaturation(e),t.target.value=this.color.saturation,this.updateSLV()},a.prototype.inputChangeValue=function(t){var e=parseInt(t.target.value);this.color.setValue(e),t.target.value=this.color.value,this.updateSLV()},a.prototype.inputChangeLightness=function(t){var e=parseInt(t.target.value);this.color.setLightness(e),t.target.value=this.color.lightness,this.updateSLV()},a.prototype.inputChangeRed=function(t){var e=parseInt(t.target.value);this.color.setByName("r",e),t.target.value=this.color.r,this.setColor(this.color)},a.prototype.inputChangeGreen=function(t){var e=parseInt(t.target.value);this.color.setByName("g",e),t.target.value=this.color.g,this.setColor(this.color)},a.prototype.inputChangeBlue=function(t){var e=parseInt(t.target.value);this.color.setByName("b",e),t.target.value=this.color.b,this.setColor(this.color)},a.prototype.inputChangeAlpha=function(t){var e=parseFloat(t.target.value);"number"!=typeof e||isNaN(e)!==!1||0>e||e>1||(this.color.a=e.toFixed(2)),t.target.value=this.color.a,this.updateAlphaPicker(),this.updatePreviewColor()},a.prototype.inputChangeHexa=function(t){var e=t.target.value;this.color.setHexa(e),this.setColor(this.color)},a.prototype.subscribe=function(t,e){this.subscribers[t]=e},a.prototype.notify=function(t,e){this.subscribers[t]&&this.subscribers[t](e)},a.prototype.setColor=function(e){return e instanceof t!=!0?void console.log("Typeof parameter not Color"):(e.format!==this.picker_mode&&(e.setFormat(this.picker_mode),e.updateHSX()),this.color.copy(e),this.updateHuePicker(),this.updatePickerPosition(),this.updatePickerBackground(),this.updateAlphaPicker(),this.updatePreviewColor(),this.updateAlphaGradient(),this.notify("red",this.color.r),this.notify("green",this.color.g),this.notify("blue",this.color.b),this.notify("hue",this.color.hue),this.notify("saturation",this.color.saturation),this.notify("value",this.color.value),this.notify("lightness",this.color.lightness),this.notify("alpha",this.color.a),this.notify("hexa",this.color.getHexa()),void g(this.topic,this.color))},a.prototype.setPickerMode=function(t){("HSV"===t||"HSL"===t)&&(this.picker_mode=t,this.node.setAttribute("data-mode",this.picker_mode),this.setColor(this.color))};var c=function(t,e){u[t]&&u[t].setPickerMode(e)},l=function(t,e){u[t]&&u[t].setColor(e)},d=function(e){return u[e]?new t(u[e].color):void 0},v=function(t,e){void 0===h[t]&&(h[t]=[]),h[t].push(e)},f=function(t){h.indexOf(t),h.splice(index,1)},g=function(e,i){if(void 0!==h[e]&&0!==h[e].length){var o=new t(i);for(var s in h[e])h[e][s](o)}},y=function(t,e){if("rgb"===e){var i=t.querySelector('[data-topic="red"] input').value,o=t.querySelector('[data-topic="green"] input').value,s=t.querySelector('[data-topic="blue"] input').value;t.querySelector(".jscolor").value="rgb("+i+","+o+","+s+")"}else if("rgba"===e){var i=t.querySelector('[data-topic="red"] input').value,o=t.querySelector('[data-topic="green"] input').value,s=t.querySelector('[data-topic="blue"] input').value,r=t.querySelector('[data-topic="alpha"] input').value;t.querySelector(".jscolor").value="rgba("+i+","+o+","+s+","+r+")"}else{var n=t.querySelector('[data-topic="hexa"] input').value;t.querySelector(".jscolor").value=n}},m=function(){for(var t=document.querySelectorAll(".ui-color-picker-wrapper"),e=0;e<t.length;e++){var i=t[e],o=i.querySelector(".jscolor");new a(i.querySelector(".ui-color-picker")),i.querySelector(".preview-color").style.backgroundColor=o.value,o.addEventListener("focus",function(){i.classList.add("open")}),document.addEventListener("click",function(t){var e=i.contains(t.target);if(!e){var o=i.querySelector(".ui-color-picker").getAttribute("data-format");y(i,o),i.classList.remove("open")}},!0)}};return{init:m,Color:t,RGBColor:e,RGBAColor:i,HSVColor:o,HSVAColor:s,HSLColor:r,HSLAColor:n,setColor:l,getColor:d,subscribe:v,unsubscribe:f,setPickerMode:c}}();document.addEventListener("DOMContentLoaded",function(){JUIColorPicker.init()});