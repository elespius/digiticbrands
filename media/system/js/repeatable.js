!function(e){"use strict";e.JRepeatable=function(t,n,o){function a(){i(),h.prependTo(g),h.show(),g.show(),r(),m.show()}function i(){function t(e){return function(t){t.stopPropagation(),t.preventDefault(),e&&p(),h.detach().find("tbody tr").remove(),g.empty(),d()}}var n,o,a;g.css("top",e(document).scrollTop()+.1*e(window).height()),n=e('<button class="btn button btn-primary"/>').text(Joomla.JText._("JAPPLY")).on("click",t(!0)),o=e('<button class="btn button btn-link"/>').text(Joomla.JText._("JCANCEL")).on("click",t(!1)),a=e('<div class="controls form-actions"/>').css({textAlign:"right",marginBottom:0}).append(o,n),g.append(h,a),f()}function r(){g.css("margin-left",g.width()*-.5)}function d(){h.hide(),g.hide(),m.hide()}function c(){function t(t){t.preventDefault(),t.stopPropagation();var n=e(t.target).parents("tr").first();if(!n.length)return!1;var a=h.find("tbody tr").length;if(a>=o)return!1;var i=h.find("tbody").first();return v.clone().appendTo(i).find("select").chosen({disable_search_threshold:10,allow_single_deselect:!0}),a=h.find("tbody tr").length,a>=o&&g.find(".add").removeClass("btn-success").addClass("disabled"),s(),r(),!1}function n(t){t.preventDefault(),t.stopPropagation();var n=e(t.target).parents("tr").first();if(!n.length)return!1;n.remove();var a=h.find("tbody tr").length;return o>a&&g.find(".add").removeClass("disabled").addClass("btn-success"),r(),!1}g.on("click","a.add",t).on("click","a.remove",n)}function s(){h.find("tbody tr").each(function(e,t){l(t,e)})}function l(t,n){var o=/(\[[\d]+\])?(\[\])?$/;e(t).find("input, textarea, select").each(function(t,a){null===a.name.match(o)?a.name+="["+n+"]":a.name=a.name.replace(o,"["+n+"]$2"),a.id=a.name.replace(/\[|\]/gi,"_").replace(/_+/gi,"_")+t,e(a).next("label").attr("for",a.id)})}function f(){function t(t,n){o.find("input, textarea, select").filter('[name$="['+n+"]["+a+']"], [name$="['+n+"]["+a+'][]"]').each(function(t,o){if("undefined"!=typeof i[n]&&"undefined"!=typeof i[n][a]){var r=e(o),d=r.attr("type"),c=i[n][a]instanceof Array?i[n][a]:[];-1!==e.inArray(d,["radio","checkbox"])&&-1!==e.inArray(o.value,c)?r.prop("checked",!0):r.val(i[n][a])}})}var o,a,i=JSON.parse(u.val())||{},r=!!(n.length>0&&i[n[0]]&&i[n[0]].length>0),d=r?i[n[0]].length:1,c=[];for(a=0;d>a;a++)o=v.clone(),l(o,a),r&&e.each(n,t),c.push(o);h.find("tbody").append(c).find("select").chosen({disable_search_threshold:10,allow_single_deselect:!0})}function p(){function t(t,a){var i,r,d=e(a),c=d.attr("type"),s=d.val(),l=a.name.match(o);l&&(i=l[1],r=l[2],"undefined"==typeof n[i]&&(n[i]=[]),"radio"===c||"checkbox"===c?("undefined"==typeof n[i][r]&&(n[i][r]=[]),d.prop("checked")&&n[i][r].push(s)):n[i][r]=s)}var n={},o=/\[([\w\s]+)\]\[([\d]+)\](\[\])?/;return h.find("tbody").find("input, textarea, select").each(t),u.val(JSON.stringify(n)),!0}var u=e("#"+t),h=e("#"+t+"_modal"),b=e("#"+t+"_modal_button"),v=h.find("tbody tr").first().detach(),g=e("<div>"),m=e("<div>");v.find(".chzn-container").remove(),v.find("select").removeClass("chzn-done").show(),m.css({backgroundColor:"#000",opacity:.4,zIndex:9998,position:"fixed",left:0,top:0,height:"100%",width:"100%"}).hide().appendTo("body"),g.css({padding:"5px",backgroundColor:"#fff",display:"none",zIndex:9999,position:"absolute",left:"50%",top:e(document).scrollTop()+.1*e(window).height()}).appendTo("body"),c(),b.on("click",function(e){return e.stopPropagation(),e.preventDefault(),a(),!1})}}(jQuery);